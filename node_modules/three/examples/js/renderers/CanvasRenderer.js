'use strict';

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.SpriteCanvasMaterial = function (parameters) {

		THREE.Material.call(this);

		this.type = 'SpriteCanvasMaterial';

		this.color = new THREE.Color(0xffffff);
		this.program = function (context, color) {};

		this.setValues(parameters);
};

THREE.SpriteCanvasMaterial.prototype = Object.create(THREE.Material.prototype);
THREE.SpriteCanvasMaterial.prototype.constructor = THREE.SpriteCanvasMaterial;

THREE.SpriteCanvasMaterial.prototype.clone = function () {

		var material = new THREE.SpriteCanvasMaterial();

		material.copy(this);
		material.color.copy(this.color);
		material.program = this.program;

		return material;
};

//

THREE.CanvasRenderer = function (parameters) {

		console.log('THREE.CanvasRenderer', THREE.REVISION);

		parameters = parameters || {};

		var _this = this,
		    _renderData,
		    _elements,
		    _lights,
		    _projector = new THREE.Projector(),
		    _canvas = parameters.canvas !== undefined ? parameters.canvas : document.createElement('canvas'),
		    _canvasWidth = _canvas.width,
		    _canvasHeight = _canvas.height,
		    _canvasWidthHalf = Math.floor(_canvasWidth / 2),
		    _canvasHeightHalf = Math.floor(_canvasHeight / 2),
		    _viewportX = 0,
		    _viewportY = 0,
		    _viewportWidth = _canvasWidth,
		    _viewportHeight = _canvasHeight,
		    _pixelRatio = 1,
		    _context = _canvas.getContext('2d', {
				alpha: parameters.alpha === true
		}),
		    _clearColor = new THREE.Color(0x000000),
		    _clearAlpha = parameters.alpha === true ? 0 : 1,
		    _contextGlobalAlpha = 1,
		    _contextGlobalCompositeOperation = 0,
		    _contextStrokeStyle = null,
		    _contextFillStyle = null,
		    _contextLineWidth = null,
		    _contextLineCap = null,
		    _contextLineJoin = null,
		    _contextLineDash = [],
		    _camera,
		    _v1,
		    _v2,
		    _v3,
		    _v4,
		    _v5 = new THREE.RenderableVertex(),
		    _v6 = new THREE.RenderableVertex(),
		    _v1x,
		    _v1y,
		    _v2x,
		    _v2y,
		    _v3x,
		    _v3y,
		    _v4x,
		    _v4y,
		    _v5x,
		    _v5y,
		    _v6x,
		    _v6y,
		    _color = new THREE.Color(),
		    _color1 = new THREE.Color(),
		    _color2 = new THREE.Color(),
		    _color3 = new THREE.Color(),
		    _color4 = new THREE.Color(),
		    _diffuseColor = new THREE.Color(),
		    _emissiveColor = new THREE.Color(),
		    _lightColor = new THREE.Color(),
		    _patterns = {},
		    _image,
		    _uvs,
		    _uv1x,
		    _uv1y,
		    _uv2x,
		    _uv2y,
		    _uv3x,
		    _uv3y,
		    _clipBox = new THREE.Box2(),
		    _clearBox = new THREE.Box2(),
		    _elemBox = new THREE.Box2(),
		    _ambientLight = new THREE.Color(),
		    _directionalLights = new THREE.Color(),
		    _pointLights = new THREE.Color(),
		    _vector3 = new THREE.Vector3(),
		    // Needed for PointLight
		_centroid = new THREE.Vector3(),
		    _normal = new THREE.Vector3(),
		    _normalViewMatrix = new THREE.Matrix3();

		/* TODO
  _canvas.mozImageSmoothingEnabled = false;
  _canvas.webkitImageSmoothingEnabled = false;
  _canvas.msImageSmoothingEnabled = false;
  _canvas.imageSmoothingEnabled = false;
  */

		// dash+gap fallbacks for Firefox and everything else

		if (_context.setLineDash === undefined) {

				_context.setLineDash = function () {};
		}

		this.domElement = _canvas;

		this.autoClear = true;
		this.sortObjects = true;
		this.sortElements = true;

		this.info = {

				render: {

						vertices: 0,
						faces: 0

				}

		};

		// WebGLRenderer compatibility

		this.supportsVertexTextures = function () {};
		this.setFaceCulling = function () {};

		// API

		this.getContext = function () {

				return _context;
		};

		this.getContextAttributes = function () {

				return _context.getContextAttributes();
		};

		this.getPixelRatio = function () {

				return _pixelRatio;
		};

		this.setPixelRatio = function (value) {

				if (value !== undefined) _pixelRatio = value;
		};

		this.setSize = function (width, height, updateStyle) {

				_canvasWidth = width * _pixelRatio;
				_canvasHeight = height * _pixelRatio;

				_canvas.width = _canvasWidth;
				_canvas.height = _canvasHeight;

				_canvasWidthHalf = Math.floor(_canvasWidth / 2);
				_canvasHeightHalf = Math.floor(_canvasHeight / 2);

				if (updateStyle !== false) {

						_canvas.style.width = width + 'px';
						_canvas.style.height = height + 'px';
				}

				_clipBox.min.set(-_canvasWidthHalf, -_canvasHeightHalf);
				_clipBox.max.set(_canvasWidthHalf, _canvasHeightHalf);

				_clearBox.min.set(-_canvasWidthHalf, -_canvasHeightHalf);
				_clearBox.max.set(_canvasWidthHalf, _canvasHeightHalf);

				_contextGlobalAlpha = 1;
				_contextGlobalCompositeOperation = 0;
				_contextStrokeStyle = null;
				_contextFillStyle = null;
				_contextLineWidth = null;
				_contextLineCap = null;
				_contextLineJoin = null;

				this.setViewport(0, 0, width, height);
		};

		this.setViewport = function (x, y, width, height) {

				_viewportX = x * _pixelRatio;
				_viewportY = y * _pixelRatio;

				_viewportWidth = width * _pixelRatio;
				_viewportHeight = height * _pixelRatio;
		};

		this.setScissor = function () {};
		this.setScissorTest = function () {};

		this.setClearColor = function (color, alpha) {

				_clearColor.set(color);
				_clearAlpha = alpha !== undefined ? alpha : 1;

				_clearBox.min.set(-_canvasWidthHalf, -_canvasHeightHalf);
				_clearBox.max.set(_canvasWidthHalf, _canvasHeightHalf);
		};

		this.setClearColorHex = function (hex, alpha) {

				console.warn('THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.');
				this.setClearColor(hex, alpha);
		};

		this.getClearColor = function () {

				return _clearColor;
		};

		this.getClearAlpha = function () {

				return _clearAlpha;
		};

		this.getMaxAnisotropy = function () {

				return 0;
		};

		this.clear = function () {

				if (_clearBox.isEmpty() === false) {

						_clearBox.intersect(_clipBox);
						_clearBox.expandByScalar(2);

						_clearBox.min.x = _clearBox.min.x + _canvasWidthHalf;
						_clearBox.min.y = -_clearBox.min.y + _canvasHeightHalf; // higher y value !
						_clearBox.max.x = _clearBox.max.x + _canvasWidthHalf;
						_clearBox.max.y = -_clearBox.max.y + _canvasHeightHalf; // lower y value !

						if (_clearAlpha < 1) {

								_context.clearRect(_clearBox.min.x | 0, _clearBox.max.y | 0, _clearBox.max.x - _clearBox.min.x | 0, _clearBox.min.y - _clearBox.max.y | 0);
						}

						if (_clearAlpha > 0) {

								setBlending(THREE.NormalBlending);
								setOpacity(1);

								setFillStyle('rgba(' + Math.floor(_clearColor.r * 255) + ',' + Math.floor(_clearColor.g * 255) + ',' + Math.floor(_clearColor.b * 255) + ',' + _clearAlpha + ')');

								_context.fillRect(_clearBox.min.x | 0, _clearBox.max.y | 0, _clearBox.max.x - _clearBox.min.x | 0, _clearBox.min.y - _clearBox.max.y | 0);
						}

						_clearBox.makeEmpty();
				}
		};

		// compatibility

		this.clearColor = function () {};
		this.clearDepth = function () {};
		this.clearStencil = function () {};

		this.render = function (scene, camera) {

				if (camera instanceof THREE.Camera === false) {

						console.error('THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.');
						return;
				}

				if (this.autoClear === true) this.clear();

				_this.info.render.vertices = 0;
				_this.info.render.faces = 0;

				_context.setTransform(_viewportWidth / _canvasWidth, 0, 0, -_viewportHeight / _canvasHeight, _viewportX, _canvasHeight - _viewportY);
				_context.translate(_canvasWidthHalf, _canvasHeightHalf);

				_renderData = _projector.projectScene(scene, camera, this.sortObjects, this.sortElements);
				_elements = _renderData.elements;
				_lights = _renderData.lights;
				_camera = camera;

				_normalViewMatrix.getNormalMatrix(camera.matrixWorldInverse);

				/* DEBUG
    setFillStyle( 'rgba( 0, 255, 255, 0.5 )' );
    _context.fillRect( _clipBox.min.x, _clipBox.min.y, _clipBox.max.x - _clipBox.min.x, _clipBox.max.y - _clipBox.min.y );
    */

				calculateLights();

				for (var e = 0, el = _elements.length; e < el; e++) {

						var element = _elements[e];

						var material = element.material;

						if (material === undefined || material.opacity === 0) continue;

						_elemBox.makeEmpty();

						if (element instanceof THREE.RenderableSprite) {

								_v1 = element;
								_v1.x *= _canvasWidthHalf;_v1.y *= _canvasHeightHalf;

								renderSprite(_v1, element, material);
						} else if (element instanceof THREE.RenderableLine) {

								_v1 = element.v1;_v2 = element.v2;

								_v1.positionScreen.x *= _canvasWidthHalf;_v1.positionScreen.y *= _canvasHeightHalf;
								_v2.positionScreen.x *= _canvasWidthHalf;_v2.positionScreen.y *= _canvasHeightHalf;

								_elemBox.setFromPoints([_v1.positionScreen, _v2.positionScreen]);

								if (_clipBox.intersectsBox(_elemBox) === true) {

										renderLine(_v1, _v2, element, material);
								}
						} else if (element instanceof THREE.RenderableFace) {

								_v1 = element.v1;_v2 = element.v2;_v3 = element.v3;

								if (_v1.positionScreen.z < -1 || _v1.positionScreen.z > 1) continue;
								if (_v2.positionScreen.z < -1 || _v2.positionScreen.z > 1) continue;
								if (_v3.positionScreen.z < -1 || _v3.positionScreen.z > 1) continue;

								_v1.positionScreen.x *= _canvasWidthHalf;_v1.positionScreen.y *= _canvasHeightHalf;
								_v2.positionScreen.x *= _canvasWidthHalf;_v2.positionScreen.y *= _canvasHeightHalf;
								_v3.positionScreen.x *= _canvasWidthHalf;_v3.positionScreen.y *= _canvasHeightHalf;

								if (material.overdraw > 0) {

										expand(_v1.positionScreen, _v2.positionScreen, material.overdraw);
										expand(_v2.positionScreen, _v3.positionScreen, material.overdraw);
										expand(_v3.positionScreen, _v1.positionScreen, material.overdraw);
								}

								_elemBox.setFromPoints([_v1.positionScreen, _v2.positionScreen, _v3.positionScreen]);

								if (_clipBox.intersectsBox(_elemBox) === true) {

										renderFace3(_v1, _v2, _v3, 0, 1, 2, element, material);
								}
						}

						/* DEBUG
      setLineWidth( 1 );
      setStrokeStyle( 'rgba( 0, 255, 0, 0.5 )' );
      _context.strokeRect( _elemBox.min.x, _elemBox.min.y, _elemBox.max.x - _elemBox.min.x, _elemBox.max.y - _elemBox.min.y );
      */

						_clearBox.union(_elemBox);
				}

				/* DEBUG
    setLineWidth( 1 );
    setStrokeStyle( 'rgba( 255, 0, 0, 0.5 )' );
    _context.strokeRect( _clearBox.min.x, _clearBox.min.y, _clearBox.max.x - _clearBox.min.x, _clearBox.max.y - _clearBox.min.y );
    */

				_context.setTransform(1, 0, 0, 1, 0, 0);
		};

		//

		function calculateLights() {

				_ambientLight.setRGB(0, 0, 0);
				_directionalLights.setRGB(0, 0, 0);
				_pointLights.setRGB(0, 0, 0);

				for (var l = 0, ll = _lights.length; l < ll; l++) {

						var light = _lights[l];
						var lightColor = light.color;

						if (light instanceof THREE.AmbientLight) {

								_ambientLight.add(lightColor);
						} else if (light instanceof THREE.DirectionalLight) {

								// for sprites

								_directionalLights.add(lightColor);
						} else if (light instanceof THREE.PointLight) {

								// for sprites

								_pointLights.add(lightColor);
						}
				}
		}

		function calculateLight(position, normal, color) {

				for (var l = 0, ll = _lights.length; l < ll; l++) {

						var light = _lights[l];

						_lightColor.copy(light.color);

						if (light instanceof THREE.DirectionalLight) {

								var lightPosition = _vector3.setFromMatrixPosition(light.matrixWorld).normalize();

								var amount = normal.dot(lightPosition);

								if (amount <= 0) continue;

								amount *= light.intensity;

								color.add(_lightColor.multiplyScalar(amount));
						} else if (light instanceof THREE.PointLight) {

								var lightPosition = _vector3.setFromMatrixPosition(light.matrixWorld);

								var amount = normal.dot(_vector3.subVectors(lightPosition, position).normalize());

								if (amount <= 0) continue;

								amount *= light.distance == 0 ? 1 : 1 - Math.min(position.distanceTo(lightPosition) / light.distance, 1);

								if (amount == 0) continue;

								amount *= light.intensity;

								color.add(_lightColor.multiplyScalar(amount));
						}
				}
		}

		function renderSprite(v1, element, material) {

				setOpacity(material.opacity);
				setBlending(material.blending);

				var scaleX = element.scale.x * _canvasWidthHalf;
				var scaleY = element.scale.y * _canvasHeightHalf;

				var dist = 0.5 * Math.sqrt(scaleX * scaleX + scaleY * scaleY); // allow for rotated sprite
				_elemBox.min.set(v1.x - dist, v1.y - dist);
				_elemBox.max.set(v1.x + dist, v1.y + dist);

				if (material instanceof THREE.SpriteMaterial) {

						var texture = material.map;

						if (texture !== null) {

								var pattern = _patterns[texture.id];

								if (pattern === undefined || pattern.version !== texture.version) {

										pattern = textureToPattern(texture);
										_patterns[texture.id] = pattern;
								}

								if (pattern.canvas !== undefined) {

										setFillStyle(pattern.canvas);

										var bitmap = texture.image;

										var ox = bitmap.width * texture.offset.x;
										var oy = bitmap.height * texture.offset.y;

										var sx = bitmap.width * texture.repeat.x;
										var sy = bitmap.height * texture.repeat.y;

										var cx = scaleX / sx;
										var cy = scaleY / sy;

										_context.save();
										_context.translate(v1.x, v1.y);
										if (material.rotation !== 0) _context.rotate(material.rotation);
										_context.translate(-scaleX / 2, -scaleY / 2);
										_context.scale(cx, cy);
										_context.translate(-ox, -oy);
										_context.fillRect(ox, oy, sx, sy);
										_context.restore();
								}
						} else {

								// no texture

								setFillStyle(material.color.getStyle());

								_context.save();
								_context.translate(v1.x, v1.y);
								if (material.rotation !== 0) _context.rotate(material.rotation);
								_context.scale(scaleX, -scaleY);
								_context.fillRect(-0.5, -0.5, 1, 1);
								_context.restore();
						}
				} else if (material instanceof THREE.SpriteCanvasMaterial) {

						setStrokeStyle(material.color.getStyle());
						setFillStyle(material.color.getStyle());

						_context.save();
						_context.translate(v1.x, v1.y);
						if (material.rotation !== 0) _context.rotate(material.rotation);
						_context.scale(scaleX, scaleY);

						material.program(_context);

						_context.restore();
				}

				/* DEBUG
    setStrokeStyle( 'rgb(255,255,0)' );
    _context.beginPath();
    _context.moveTo( v1.x - 10, v1.y );
    _context.lineTo( v1.x + 10, v1.y );
    _context.moveTo( v1.x, v1.y - 10 );
    _context.lineTo( v1.x, v1.y + 10 );
    _context.stroke();
    */
		}

		function renderLine(v1, v2, element, material) {

				setOpacity(material.opacity);
				setBlending(material.blending);

				_context.beginPath();
				_context.moveTo(v1.positionScreen.x, v1.positionScreen.y);
				_context.lineTo(v2.positionScreen.x, v2.positionScreen.y);

				if (material instanceof THREE.LineBasicMaterial) {

						setLineWidth(material.linewidth);
						setLineCap(material.linecap);
						setLineJoin(material.linejoin);

						if (material.vertexColors !== THREE.VertexColors) {

								setStrokeStyle(material.color.getStyle());
						} else {

								var colorStyle1 = element.vertexColors[0].getStyle();
								var colorStyle2 = element.vertexColors[1].getStyle();

								if (colorStyle1 === colorStyle2) {

										setStrokeStyle(colorStyle1);
								} else {

										try {

												var grad = _context.createLinearGradient(v1.positionScreen.x, v1.positionScreen.y, v2.positionScreen.x, v2.positionScreen.y);
												grad.addColorStop(0, colorStyle1);
												grad.addColorStop(1, colorStyle2);
										} catch (exception) {

												grad = colorStyle1;
										}

										setStrokeStyle(grad);
								}
						}

						_context.stroke();
						_elemBox.expandByScalar(material.linewidth * 2);
				} else if (material instanceof THREE.LineDashedMaterial) {

						setLineWidth(material.linewidth);
						setLineCap(material.linecap);
						setLineJoin(material.linejoin);
						setStrokeStyle(material.color.getStyle());
						setLineDash([material.dashSize, material.gapSize]);

						_context.stroke();

						_elemBox.expandByScalar(material.linewidth * 2);

						setLineDash([]);
				}
		}

		function renderFace3(v1, v2, v3, uv1, uv2, uv3, element, material) {

				_this.info.render.vertices += 3;
				_this.info.render.faces++;

				setOpacity(material.opacity);
				setBlending(material.blending);

				_v1x = v1.positionScreen.x;_v1y = v1.positionScreen.y;
				_v2x = v2.positionScreen.x;_v2y = v2.positionScreen.y;
				_v3x = v3.positionScreen.x;_v3y = v3.positionScreen.y;

				drawTriangle(_v1x, _v1y, _v2x, _v2y, _v3x, _v3y);

				if ((material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshPhongMaterial) && material.map === null) {

						_diffuseColor.copy(material.color);
						_emissiveColor.copy(material.emissive);

						if (material.vertexColors === THREE.FaceColors) {

								_diffuseColor.multiply(element.color);
						}

						_color.copy(_ambientLight);

						_centroid.copy(v1.positionWorld).add(v2.positionWorld).add(v3.positionWorld).divideScalar(3);

						calculateLight(_centroid, element.normalModel, _color);

						_color.multiply(_diffuseColor).add(_emissiveColor);

						material.wireframe === true ? strokePath(_color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin) : fillPath(_color);
				} else if (material instanceof THREE.MeshBasicMaterial || material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshPhongMaterial) {

						if (material.map !== null) {

								var mapping = material.map.mapping;

								if (mapping === THREE.UVMapping) {

										_uvs = element.uvs;
										patternPath(_v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uvs[uv1].x, _uvs[uv1].y, _uvs[uv2].x, _uvs[uv2].y, _uvs[uv3].x, _uvs[uv3].y, material.map);
								}
						} else if (material.envMap !== null) {

								if (material.envMap.mapping === THREE.SphericalReflectionMapping) {

										_normal.copy(element.vertexNormalsModel[uv1]).applyMatrix3(_normalViewMatrix);
										_uv1x = 0.5 * _normal.x + 0.5;
										_uv1y = 0.5 * _normal.y + 0.5;

										_normal.copy(element.vertexNormalsModel[uv2]).applyMatrix3(_normalViewMatrix);
										_uv2x = 0.5 * _normal.x + 0.5;
										_uv2y = 0.5 * _normal.y + 0.5;

										_normal.copy(element.vertexNormalsModel[uv3]).applyMatrix3(_normalViewMatrix);
										_uv3x = 0.5 * _normal.x + 0.5;
										_uv3y = 0.5 * _normal.y + 0.5;

										patternPath(_v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y, material.envMap);
								}
						} else {

								_color.copy(material.color);

								if (material.vertexColors === THREE.FaceColors) {

										_color.multiply(element.color);
								}

								material.wireframe === true ? strokePath(_color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin) : fillPath(_color);
						}
				} else if (material instanceof THREE.MeshNormalMaterial) {

						_normal.copy(element.normalModel).applyMatrix3(_normalViewMatrix);

						_color.setRGB(_normal.x, _normal.y, _normal.z).multiplyScalar(0.5).addScalar(0.5);

						material.wireframe === true ? strokePath(_color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin) : fillPath(_color);
				} else {

						_color.setRGB(1, 1, 1);

						material.wireframe === true ? strokePath(_color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin) : fillPath(_color);
				}
		}

		//

		function drawTriangle(x0, y0, x1, y1, x2, y2) {

				_context.beginPath();
				_context.moveTo(x0, y0);
				_context.lineTo(x1, y1);
				_context.lineTo(x2, y2);
				_context.closePath();
		}

		function strokePath(color, linewidth, linecap, linejoin) {

				setLineWidth(linewidth);
				setLineCap(linecap);
				setLineJoin(linejoin);
				setStrokeStyle(color.getStyle());

				_context.stroke();

				_elemBox.expandByScalar(linewidth * 2);
		}

		function fillPath(color) {

				setFillStyle(color.getStyle());
				_context.fill();
		}

		function textureToPattern(texture) {

				if (texture.version === 0 || texture instanceof THREE.CompressedTexture || texture instanceof THREE.DataTexture) {

						return {
								canvas: undefined,
								version: texture.version
						};
				}

				var image = texture.image;

				if (image.complete === false) {

						return {
								canvas: undefined,
								version: 0
						};
				}

				var canvas = document.createElement('canvas');
				canvas.width = image.width;
				canvas.height = image.height;

				var context = canvas.getContext('2d');
				context.setTransform(1, 0, 0, -1, 0, image.height);
				context.drawImage(image, 0, 0);

				var repeatX = texture.wrapS === THREE.RepeatWrapping;
				var repeatY = texture.wrapT === THREE.RepeatWrapping;

				var repeat = 'no-repeat';

				if (repeatX === true && repeatY === true) {

						repeat = 'repeat';
				} else if (repeatX === true) {

						repeat = 'repeat-x';
				} else if (repeatY === true) {

						repeat = 'repeat-y';
				}

				var pattern = _context.createPattern(canvas, repeat);

				if (texture.onUpdate) texture.onUpdate(texture);

				return {
						canvas: pattern,
						version: texture.version
				};
		}

		function patternPath(x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, texture) {

				var pattern = _patterns[texture.id];

				if (pattern === undefined || pattern.version !== texture.version) {

						pattern = textureToPattern(texture);
						_patterns[texture.id] = pattern;
				}

				if (pattern.canvas !== undefined) {

						setFillStyle(pattern.canvas);
				} else {

						setFillStyle('rgba( 0, 0, 0, 1)');
						_context.fill();
						return;
				}

				// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120

				var a,
				    b,
				    c,
				    d,
				    e,
				    f,
				    det,
				    idet,
				    offsetX = texture.offset.x / texture.repeat.x,
				    offsetY = texture.offset.y / texture.repeat.y,
				    width = texture.image.width * texture.repeat.x,
				    height = texture.image.height * texture.repeat.y;

				u0 = (u0 + offsetX) * width;
				v0 = (v0 + offsetY) * height;

				u1 = (u1 + offsetX) * width;
				v1 = (v1 + offsetY) * height;

				u2 = (u2 + offsetX) * width;
				v2 = (v2 + offsetY) * height;

				x1 -= x0;y1 -= y0;
				x2 -= x0;y2 -= y0;

				u1 -= u0;v1 -= v0;
				u2 -= u0;v2 -= v0;

				det = u1 * v2 - u2 * v1;

				if (det === 0) return;

				idet = 1 / det;

				a = (v2 * x1 - v1 * x2) * idet;
				b = (v2 * y1 - v1 * y2) * idet;
				c = (u1 * x2 - u2 * x1) * idet;
				d = (u1 * y2 - u2 * y1) * idet;

				e = x0 - a * u0 - c * v0;
				f = y0 - b * u0 - d * v0;

				_context.save();
				_context.transform(a, b, c, d, e, f);
				_context.fill();
				_context.restore();
		}

		function clipImage(x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, image) {

				// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120

				var a,
				    b,
				    c,
				    d,
				    e,
				    f,
				    det,
				    idet,
				    width = image.width - 1,
				    height = image.height - 1;

				u0 *= width;v0 *= height;
				u1 *= width;v1 *= height;
				u2 *= width;v2 *= height;

				x1 -= x0;y1 -= y0;
				x2 -= x0;y2 -= y0;

				u1 -= u0;v1 -= v0;
				u2 -= u0;v2 -= v0;

				det = u1 * v2 - u2 * v1;

				idet = 1 / det;

				a = (v2 * x1 - v1 * x2) * idet;
				b = (v2 * y1 - v1 * y2) * idet;
				c = (u1 * x2 - u2 * x1) * idet;
				d = (u1 * y2 - u2 * y1) * idet;

				e = x0 - a * u0 - c * v0;
				f = y0 - b * u0 - d * v0;

				_context.save();
				_context.transform(a, b, c, d, e, f);
				_context.clip();
				_context.drawImage(image, 0, 0);
				_context.restore();
		}

		// Hide anti-alias gaps

		function expand(v1, v2, pixels) {

				var x = v2.x - v1.x,
				    y = v2.y - v1.y,
				    det = x * x + y * y,
				    idet;

				if (det === 0) return;

				idet = pixels / Math.sqrt(det);

				x *= idet;y *= idet;

				v2.x += x;v2.y += y;
				v1.x -= x;v1.y -= y;
		}

		// Context cached methods.

		function setOpacity(value) {

				if (_contextGlobalAlpha !== value) {

						_context.globalAlpha = value;
						_contextGlobalAlpha = value;
				}
		}

		function setBlending(value) {

				if (_contextGlobalCompositeOperation !== value) {

						if (value === THREE.NormalBlending) {

								_context.globalCompositeOperation = 'source-over';
						} else if (value === THREE.AdditiveBlending) {

								_context.globalCompositeOperation = 'lighter';
						} else if (value === THREE.SubtractiveBlending) {

								_context.globalCompositeOperation = 'darker';
						}

						_contextGlobalCompositeOperation = value;
				}
		}

		function setLineWidth(value) {

				if (_contextLineWidth !== value) {

						_context.lineWidth = value;
						_contextLineWidth = value;
				}
		}

		function setLineCap(value) {

				// "butt", "round", "square"

				if (_contextLineCap !== value) {

						_context.lineCap = value;
						_contextLineCap = value;
				}
		}

		function setLineJoin(value) {

				// "round", "bevel", "miter"

				if (_contextLineJoin !== value) {

						_context.lineJoin = value;
						_contextLineJoin = value;
				}
		}

		function setStrokeStyle(value) {

				if (_contextStrokeStyle !== value) {

						_context.strokeStyle = value;
						_contextStrokeStyle = value;
				}
		}

		function setFillStyle(value) {

				if (_contextFillStyle !== value) {

						_context.fillStyle = value;
						_contextFillStyle = value;
				}
		}

		function setLineDash(value) {

				if (_contextLineDash.length !== value.length) {

						_context.setLineDash(value);
						_contextLineDash = value;
				}
		}
};
//# sourceMappingURL=data:application/json;base64,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LFdBQVMsV0FBVCxDQUFzQixLQUF0QixFQUE4Qjs7QUFFN0IsUUFBSyxpQkFBaUIsTUFBakIsS0FBNEIsTUFBTSxNQUF2QyxFQUFnRDs7QUFFL0MsZUFBUyxXQUFULENBQXNCLEtBQXRCO0FBQ0EseUJBQW1CLEtBQW5CO0FBRUE7QUFFRDtBQUVELENBdmpDRCIsImZpbGUiOiJDYW52YXNSZW5kZXJlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tL1xyXG4gKi9cclxuXHJcblRIUkVFLlNwcml0ZUNhbnZhc01hdGVyaWFsID0gZnVuY3Rpb24gKCBwYXJhbWV0ZXJzICkge1xyXG5cclxuXHRUSFJFRS5NYXRlcmlhbC5jYWxsKCB0aGlzICk7XHJcblxyXG5cdHRoaXMudHlwZSA9ICdTcHJpdGVDYW52YXNNYXRlcmlhbCc7XHJcblxyXG5cdHRoaXMuY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoIDB4ZmZmZmZmICk7XHJcblx0dGhpcy5wcm9ncmFtID0gZnVuY3Rpb24gKCBjb250ZXh0LCBjb2xvciApIHt9O1xyXG5cclxuXHR0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApO1xyXG5cclxufTtcclxuXHJcblRIUkVFLlNwcml0ZUNhbnZhc01hdGVyaWFsLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFRIUkVFLk1hdGVyaWFsLnByb3RvdHlwZSApO1xyXG5USFJFRS5TcHJpdGVDYW52YXNNYXRlcmlhbC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUSFJFRS5TcHJpdGVDYW52YXNNYXRlcmlhbDtcclxuXHJcblRIUkVFLlNwcml0ZUNhbnZhc01hdGVyaWFsLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcblx0dmFyIG1hdGVyaWFsID0gbmV3IFRIUkVFLlNwcml0ZUNhbnZhc01hdGVyaWFsKCk7XHJcblxyXG5cdG1hdGVyaWFsLmNvcHkoIHRoaXMgKTtcclxuXHRtYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmNvbG9yICk7XHJcblx0bWF0ZXJpYWwucHJvZ3JhbSA9IHRoaXMucHJvZ3JhbTtcclxuXHJcblx0cmV0dXJuIG1hdGVyaWFsO1xyXG5cclxufTtcclxuXHJcbi8vXHJcblxyXG5USFJFRS5DYW52YXNSZW5kZXJlciA9IGZ1bmN0aW9uICggcGFyYW1ldGVycyApIHtcclxuXHJcblx0Y29uc29sZS5sb2coICdUSFJFRS5DYW52YXNSZW5kZXJlcicsIFRIUkVFLlJFVklTSU9OICk7XHJcblxyXG5cdHBhcmFtZXRlcnMgPSBwYXJhbWV0ZXJzIHx8IHt9O1xyXG5cclxuXHR2YXIgX3RoaXMgPSB0aGlzLFxyXG5cdF9yZW5kZXJEYXRhLCBfZWxlbWVudHMsIF9saWdodHMsXHJcblx0X3Byb2plY3RvciA9IG5ldyBUSFJFRS5Qcm9qZWN0b3IoKSxcclxuXHJcblx0X2NhbnZhcyA9IHBhcmFtZXRlcnMuY2FudmFzICE9PSB1bmRlZmluZWRcclxuXHRcdFx0ID8gcGFyYW1ldGVycy5jYW52YXNcclxuXHRcdFx0IDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2NhbnZhcycgKSxcclxuXHJcblx0X2NhbnZhc1dpZHRoID0gX2NhbnZhcy53aWR0aCxcclxuXHRfY2FudmFzSGVpZ2h0ID0gX2NhbnZhcy5oZWlnaHQsXHJcblx0X2NhbnZhc1dpZHRoSGFsZiA9IE1hdGguZmxvb3IoIF9jYW52YXNXaWR0aCAvIDIgKSxcclxuXHRfY2FudmFzSGVpZ2h0SGFsZiA9IE1hdGguZmxvb3IoIF9jYW52YXNIZWlnaHQgLyAyICksXHJcblxyXG5cdF92aWV3cG9ydFggPSAwLFxyXG5cdF92aWV3cG9ydFkgPSAwLFxyXG5cdF92aWV3cG9ydFdpZHRoID0gX2NhbnZhc1dpZHRoLFxyXG5cdF92aWV3cG9ydEhlaWdodCA9IF9jYW52YXNIZWlnaHQsXHJcblxyXG5cdF9waXhlbFJhdGlvID0gMSxcclxuXHJcblx0X2NvbnRleHQgPSBfY2FudmFzLmdldENvbnRleHQoICcyZCcsIHtcclxuXHRcdGFscGhhOiBwYXJhbWV0ZXJzLmFscGhhID09PSB0cnVlXHJcblx0fSApLFxyXG5cclxuXHRfY2xlYXJDb2xvciA9IG5ldyBUSFJFRS5Db2xvciggMHgwMDAwMDAgKSxcclxuXHRfY2xlYXJBbHBoYSA9IHBhcmFtZXRlcnMuYWxwaGEgPT09IHRydWUgPyAwIDogMSxcclxuXHJcblx0X2NvbnRleHRHbG9iYWxBbHBoYSA9IDEsXHJcblx0X2NvbnRleHRHbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAwLFxyXG5cdF9jb250ZXh0U3Ryb2tlU3R5bGUgPSBudWxsLFxyXG5cdF9jb250ZXh0RmlsbFN0eWxlID0gbnVsbCxcclxuXHRfY29udGV4dExpbmVXaWR0aCA9IG51bGwsXHJcblx0X2NvbnRleHRMaW5lQ2FwID0gbnVsbCxcclxuXHRfY29udGV4dExpbmVKb2luID0gbnVsbCxcclxuXHRfY29udGV4dExpbmVEYXNoID0gW10sXHJcblxyXG5cdF9jYW1lcmEsXHJcblxyXG5cdF92MSwgX3YyLCBfdjMsIF92NCxcclxuXHRfdjUgPSBuZXcgVEhSRUUuUmVuZGVyYWJsZVZlcnRleCgpLFxyXG5cdF92NiA9IG5ldyBUSFJFRS5SZW5kZXJhYmxlVmVydGV4KCksXHJcblxyXG5cdF92MXgsIF92MXksIF92MngsIF92MnksIF92M3gsIF92M3ksXHJcblx0X3Y0eCwgX3Y0eSwgX3Y1eCwgX3Y1eSwgX3Y2eCwgX3Y2eSxcclxuXHJcblx0X2NvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCksXHJcblx0X2NvbG9yMSA9IG5ldyBUSFJFRS5Db2xvcigpLFxyXG5cdF9jb2xvcjIgPSBuZXcgVEhSRUUuQ29sb3IoKSxcclxuXHRfY29sb3IzID0gbmV3IFRIUkVFLkNvbG9yKCksXHJcblx0X2NvbG9yNCA9IG5ldyBUSFJFRS5Db2xvcigpLFxyXG5cclxuXHRfZGlmZnVzZUNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCksXHJcblx0X2VtaXNzaXZlQ29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoKSxcclxuXHJcblx0X2xpZ2h0Q29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoKSxcclxuXHJcblx0X3BhdHRlcm5zID0ge30sXHJcblxyXG5cdF9pbWFnZSwgX3V2cyxcclxuXHRfdXYxeCwgX3V2MXksIF91djJ4LCBfdXYyeSwgX3V2M3gsIF91djN5LFxyXG5cclxuXHRfY2xpcEJveCA9IG5ldyBUSFJFRS5Cb3gyKCksXHJcblx0X2NsZWFyQm94ID0gbmV3IFRIUkVFLkJveDIoKSxcclxuXHRfZWxlbUJveCA9IG5ldyBUSFJFRS5Cb3gyKCksXHJcblxyXG5cdF9hbWJpZW50TGlnaHQgPSBuZXcgVEhSRUUuQ29sb3IoKSxcclxuXHRfZGlyZWN0aW9uYWxMaWdodHMgPSBuZXcgVEhSRUUuQ29sb3IoKSxcclxuXHRfcG9pbnRMaWdodHMgPSBuZXcgVEhSRUUuQ29sb3IoKSxcclxuXHJcblx0X3ZlY3RvcjMgPSBuZXcgVEhSRUUuVmVjdG9yMygpLCAvLyBOZWVkZWQgZm9yIFBvaW50TGlnaHRcclxuXHRfY2VudHJvaWQgPSBuZXcgVEhSRUUuVmVjdG9yMygpLFxyXG5cdF9ub3JtYWwgPSBuZXcgVEhSRUUuVmVjdG9yMygpLFxyXG5cdF9ub3JtYWxWaWV3TWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDMoKTtcclxuXHJcblx0LyogVE9ET1xyXG5cdF9jYW52YXMubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcblx0X2NhbnZhcy53ZWJraXRJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcclxuXHRfY2FudmFzLm1zSW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XHJcblx0X2NhbnZhcy5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcclxuXHQqL1xyXG5cclxuXHQvLyBkYXNoK2dhcCBmYWxsYmFja3MgZm9yIEZpcmVmb3ggYW5kIGV2ZXJ5dGhpbmcgZWxzZVxyXG5cclxuXHRpZiAoIF9jb250ZXh0LnNldExpbmVEYXNoID09PSB1bmRlZmluZWQgKSB7XHJcblxyXG5cdFx0X2NvbnRleHQuc2V0TGluZURhc2ggPSBmdW5jdGlvbiAoKSB7fTtcclxuXHJcblx0fVxyXG5cclxuXHR0aGlzLmRvbUVsZW1lbnQgPSBfY2FudmFzO1xyXG5cclxuXHR0aGlzLmF1dG9DbGVhciA9IHRydWU7XHJcblx0dGhpcy5zb3J0T2JqZWN0cyA9IHRydWU7XHJcblx0dGhpcy5zb3J0RWxlbWVudHMgPSB0cnVlO1xyXG5cclxuXHR0aGlzLmluZm8gPSB7XHJcblxyXG5cdFx0cmVuZGVyOiB7XHJcblxyXG5cdFx0XHR2ZXJ0aWNlczogMCxcclxuXHRcdFx0ZmFjZXM6IDBcclxuXHJcblx0XHR9XHJcblxyXG5cdH07XHJcblxyXG5cdC8vIFdlYkdMUmVuZGVyZXIgY29tcGF0aWJpbGl0eVxyXG5cclxuXHR0aGlzLnN1cHBvcnRzVmVydGV4VGV4dHVyZXMgPSBmdW5jdGlvbiAoKSB7fTtcclxuXHR0aGlzLnNldEZhY2VDdWxsaW5nID0gZnVuY3Rpb24gKCkge307XHJcblxyXG5cdC8vIEFQSVxyXG5cclxuXHR0aGlzLmdldENvbnRleHQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0cmV0dXJuIF9jb250ZXh0O1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLmdldENvbnRleHRBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdHJldHVybiBfY29udGV4dC5nZXRDb250ZXh0QXR0cmlidXRlcygpO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLmdldFBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0cmV0dXJuIF9waXhlbFJhdGlvO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLnNldFBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoIHZhbHVlICkge1xyXG5cclxuXHRcdGlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIF9waXhlbFJhdGlvID0gdmFsdWU7XHJcblxyXG5cdH07XHJcblxyXG5cdHRoaXMuc2V0U2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgdXBkYXRlU3R5bGUgKSB7XHJcblxyXG5cdFx0X2NhbnZhc1dpZHRoID0gd2lkdGggKiBfcGl4ZWxSYXRpbztcclxuXHRcdF9jYW52YXNIZWlnaHQgPSBoZWlnaHQgKiBfcGl4ZWxSYXRpbztcclxuXHJcblx0XHRfY2FudmFzLndpZHRoID0gX2NhbnZhc1dpZHRoO1xyXG5cdFx0X2NhbnZhcy5oZWlnaHQgPSBfY2FudmFzSGVpZ2h0O1xyXG5cclxuXHRcdF9jYW52YXNXaWR0aEhhbGYgPSBNYXRoLmZsb29yKCBfY2FudmFzV2lkdGggLyAyICk7XHJcblx0XHRfY2FudmFzSGVpZ2h0SGFsZiA9IE1hdGguZmxvb3IoIF9jYW52YXNIZWlnaHQgLyAyICk7XHJcblxyXG5cdFx0aWYgKCB1cGRhdGVTdHlsZSAhPT0gZmFsc2UgKSB7XHJcblxyXG5cdFx0XHRfY2FudmFzLnN0eWxlLndpZHRoID0gd2lkdGggKyAncHgnO1xyXG5cdFx0XHRfY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdF9jbGlwQm94Lm1pbi5zZXQoIC0gX2NhbnZhc1dpZHRoSGFsZiwgLSBfY2FudmFzSGVpZ2h0SGFsZiApO1xyXG5cdFx0X2NsaXBCb3gubWF4LnNldCggICBfY2FudmFzV2lkdGhIYWxmLCAgIF9jYW52YXNIZWlnaHRIYWxmICk7XHJcblxyXG5cdFx0X2NsZWFyQm94Lm1pbi5zZXQoIC0gX2NhbnZhc1dpZHRoSGFsZiwgLSBfY2FudmFzSGVpZ2h0SGFsZiApO1xyXG5cdFx0X2NsZWFyQm94Lm1heC5zZXQoICAgX2NhbnZhc1dpZHRoSGFsZiwgICBfY2FudmFzSGVpZ2h0SGFsZiApO1xyXG5cclxuXHRcdF9jb250ZXh0R2xvYmFsQWxwaGEgPSAxO1xyXG5cdFx0X2NvbnRleHRHbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAwO1xyXG5cdFx0X2NvbnRleHRTdHJva2VTdHlsZSA9IG51bGw7XHJcblx0XHRfY29udGV4dEZpbGxTdHlsZSA9IG51bGw7XHJcblx0XHRfY29udGV4dExpbmVXaWR0aCA9IG51bGw7XHJcblx0XHRfY29udGV4dExpbmVDYXAgPSBudWxsO1xyXG5cdFx0X2NvbnRleHRMaW5lSm9pbiA9IG51bGw7XHJcblxyXG5cdFx0dGhpcy5zZXRWaWV3cG9ydCggMCwgMCwgd2lkdGgsIGhlaWdodCApO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLnNldFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkge1xyXG5cclxuXHRcdF92aWV3cG9ydFggPSB4ICogX3BpeGVsUmF0aW87XHJcblx0XHRfdmlld3BvcnRZID0geSAqIF9waXhlbFJhdGlvO1xyXG5cclxuXHRcdF92aWV3cG9ydFdpZHRoID0gd2lkdGggKiBfcGl4ZWxSYXRpbztcclxuXHRcdF92aWV3cG9ydEhlaWdodCA9IGhlaWdodCAqIF9waXhlbFJhdGlvO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLnNldFNjaXNzb3IgPSBmdW5jdGlvbiAoKSB7fTtcclxuXHR0aGlzLnNldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCkge307XHJcblxyXG5cdHRoaXMuc2V0Q2xlYXJDb2xvciA9IGZ1bmN0aW9uICggY29sb3IsIGFscGhhICkge1xyXG5cclxuXHRcdF9jbGVhckNvbG9yLnNldCggY29sb3IgKTtcclxuXHRcdF9jbGVhckFscGhhID0gYWxwaGEgIT09IHVuZGVmaW5lZCA/IGFscGhhIDogMTtcclxuXHJcblx0XHRfY2xlYXJCb3gubWluLnNldCggLSBfY2FudmFzV2lkdGhIYWxmLCAtIF9jYW52YXNIZWlnaHRIYWxmICk7XHJcblx0XHRfY2xlYXJCb3gubWF4LnNldCggICBfY2FudmFzV2lkdGhIYWxmLCAgIF9jYW52YXNIZWlnaHRIYWxmICk7XHJcblxyXG5cdH07XHJcblxyXG5cdHRoaXMuc2V0Q2xlYXJDb2xvckhleCA9IGZ1bmN0aW9uICggaGV4LCBhbHBoYSApIHtcclxuXHJcblx0XHRjb25zb2xlLndhcm4oICdUSFJFRS5DYW52YXNSZW5kZXJlcjogLnNldENsZWFyQ29sb3JIZXgoKSBpcyBiZWluZyByZW1vdmVkLiBVc2UgLnNldENsZWFyQ29sb3IoKSBpbnN0ZWFkLicgKTtcclxuXHRcdHRoaXMuc2V0Q2xlYXJDb2xvciggaGV4LCBhbHBoYSApO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLmdldENsZWFyQ29sb3IgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0cmV0dXJuIF9jbGVhckNvbG9yO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLmdldENsZWFyQWxwaGEgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0cmV0dXJuIF9jbGVhckFscGhhO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLmdldE1heEFuaXNvdHJvcHkgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0cmV0dXJuIDA7XHJcblxyXG5cdH07XHJcblxyXG5cdHRoaXMuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0aWYgKCBfY2xlYXJCb3guaXNFbXB0eSgpID09PSBmYWxzZSApIHtcclxuXHJcblx0XHRcdF9jbGVhckJveC5pbnRlcnNlY3QoIF9jbGlwQm94ICk7XHJcblx0XHRcdF9jbGVhckJveC5leHBhbmRCeVNjYWxhciggMiApO1xyXG5cclxuXHRcdFx0X2NsZWFyQm94Lm1pbi54ID0gX2NsZWFyQm94Lm1pbi54ICsgX2NhbnZhc1dpZHRoSGFsZjtcclxuXHRcdFx0X2NsZWFyQm94Lm1pbi55ID0gIC0gX2NsZWFyQm94Lm1pbi55ICsgX2NhbnZhc0hlaWdodEhhbGY7XHRcdC8vIGhpZ2hlciB5IHZhbHVlICFcclxuXHRcdFx0X2NsZWFyQm94Lm1heC54ID0gX2NsZWFyQm94Lm1heC54ICsgX2NhbnZhc1dpZHRoSGFsZjtcclxuXHRcdFx0X2NsZWFyQm94Lm1heC55ID0gIC0gX2NsZWFyQm94Lm1heC55ICsgX2NhbnZhc0hlaWdodEhhbGY7XHRcdC8vIGxvd2VyIHkgdmFsdWUgIVxyXG5cclxuXHRcdFx0aWYgKCBfY2xlYXJBbHBoYSA8IDEgKSB7XHJcblxyXG5cdFx0XHRcdF9jb250ZXh0LmNsZWFyUmVjdChcclxuXHRcdFx0XHRcdF9jbGVhckJveC5taW4ueCB8IDAsXHJcblx0XHRcdFx0XHRfY2xlYXJCb3gubWF4LnkgfCAwLFxyXG5cdFx0XHRcdFx0KCBfY2xlYXJCb3gubWF4LnggLSBfY2xlYXJCb3gubWluLnggKSB8IDAsXHJcblx0XHRcdFx0XHQoIF9jbGVhckJveC5taW4ueSAtIF9jbGVhckJveC5tYXgueSApIHwgMFxyXG5cdFx0XHRcdCk7XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIF9jbGVhckFscGhhID4gMCApIHtcclxuXHJcblx0XHRcdFx0c2V0QmxlbmRpbmcoIFRIUkVFLk5vcm1hbEJsZW5kaW5nICk7XHJcblx0XHRcdFx0c2V0T3BhY2l0eSggMSApO1xyXG5cclxuXHRcdFx0XHRzZXRGaWxsU3R5bGUoICdyZ2JhKCcgKyBNYXRoLmZsb29yKCBfY2xlYXJDb2xvci5yICogMjU1ICkgKyAnLCcgKyBNYXRoLmZsb29yKCBfY2xlYXJDb2xvci5nICogMjU1ICkgKyAnLCcgKyBNYXRoLmZsb29yKCBfY2xlYXJDb2xvci5iICogMjU1ICkgKyAnLCcgKyBfY2xlYXJBbHBoYSArICcpJyApO1xyXG5cclxuXHRcdFx0XHRfY29udGV4dC5maWxsUmVjdChcclxuXHRcdFx0XHRcdF9jbGVhckJveC5taW4ueCB8IDAsXHJcblx0XHRcdFx0XHRfY2xlYXJCb3gubWF4LnkgfCAwLFxyXG5cdFx0XHRcdFx0KCBfY2xlYXJCb3gubWF4LnggLSBfY2xlYXJCb3gubWluLnggKSB8IDAsXHJcblx0XHRcdFx0XHQoIF9jbGVhckJveC5taW4ueSAtIF9jbGVhckJveC5tYXgueSApIHwgMFxyXG5cdFx0XHRcdCk7XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRfY2xlYXJCb3gubWFrZUVtcHR5KCk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9O1xyXG5cclxuXHQvLyBjb21wYXRpYmlsaXR5XHJcblxyXG5cdHRoaXMuY2xlYXJDb2xvciA9IGZ1bmN0aW9uICgpIHt9O1xyXG5cdHRoaXMuY2xlYXJEZXB0aCA9IGZ1bmN0aW9uICgpIHt9O1xyXG5cdHRoaXMuY2xlYXJTdGVuY2lsID0gZnVuY3Rpb24gKCkge307XHJcblxyXG5cdHRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhICkge1xyXG5cclxuXHRcdGlmICggY2FtZXJhIGluc3RhbmNlb2YgVEhSRUUuQ2FtZXJhID09PSBmYWxzZSApIHtcclxuXHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoICdUSFJFRS5DYW52YXNSZW5kZXJlci5yZW5kZXI6IGNhbWVyYSBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuQ2FtZXJhLicgKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIHRoaXMuYXV0b0NsZWFyID09PSB0cnVlICkgdGhpcy5jbGVhcigpO1xyXG5cclxuXHRcdF90aGlzLmluZm8ucmVuZGVyLnZlcnRpY2VzID0gMDtcclxuXHRcdF90aGlzLmluZm8ucmVuZGVyLmZhY2VzID0gMDtcclxuXHJcblx0XHRfY29udGV4dC5zZXRUcmFuc2Zvcm0oIF92aWV3cG9ydFdpZHRoIC8gX2NhbnZhc1dpZHRoLCAwLCAwLCAtIF92aWV3cG9ydEhlaWdodCAvIF9jYW52YXNIZWlnaHQsIF92aWV3cG9ydFgsIF9jYW52YXNIZWlnaHQgLSBfdmlld3BvcnRZICk7XHJcblx0XHRfY29udGV4dC50cmFuc2xhdGUoIF9jYW52YXNXaWR0aEhhbGYsIF9jYW52YXNIZWlnaHRIYWxmICk7XHJcblxyXG5cdFx0X3JlbmRlckRhdGEgPSBfcHJvamVjdG9yLnByb2plY3RTY2VuZSggc2NlbmUsIGNhbWVyYSwgdGhpcy5zb3J0T2JqZWN0cywgdGhpcy5zb3J0RWxlbWVudHMgKTtcclxuXHRcdF9lbGVtZW50cyA9IF9yZW5kZXJEYXRhLmVsZW1lbnRzO1xyXG5cdFx0X2xpZ2h0cyA9IF9yZW5kZXJEYXRhLmxpZ2h0cztcclxuXHRcdF9jYW1lcmEgPSBjYW1lcmE7XHJcblxyXG5cdFx0X25vcm1hbFZpZXdNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7XHJcblxyXG5cdFx0LyogREVCVUdcclxuXHRcdHNldEZpbGxTdHlsZSggJ3JnYmEoIDAsIDI1NSwgMjU1LCAwLjUgKScgKTtcclxuXHRcdF9jb250ZXh0LmZpbGxSZWN0KCBfY2xpcEJveC5taW4ueCwgX2NsaXBCb3gubWluLnksIF9jbGlwQm94Lm1heC54IC0gX2NsaXBCb3gubWluLngsIF9jbGlwQm94Lm1heC55IC0gX2NsaXBCb3gubWluLnkgKTtcclxuXHRcdCovXHJcblxyXG5cdFx0Y2FsY3VsYXRlTGlnaHRzKCk7XHJcblxyXG5cdFx0Zm9yICggdmFyIGUgPSAwLCBlbCA9IF9lbGVtZW50cy5sZW5ndGg7IGUgPCBlbDsgZSArKyApIHtcclxuXHJcblx0XHRcdHZhciBlbGVtZW50ID0gX2VsZW1lbnRzWyBlIF07XHJcblxyXG5cdFx0XHR2YXIgbWF0ZXJpYWwgPSBlbGVtZW50Lm1hdGVyaWFsO1xyXG5cclxuXHRcdFx0aWYgKCBtYXRlcmlhbCA9PT0gdW5kZWZpbmVkIHx8IG1hdGVyaWFsLm9wYWNpdHkgPT09IDAgKSBjb250aW51ZTtcclxuXHJcblx0XHRcdF9lbGVtQm94Lm1ha2VFbXB0eSgpO1xyXG5cclxuXHRcdFx0aWYgKCBlbGVtZW50IGluc3RhbmNlb2YgVEhSRUUuUmVuZGVyYWJsZVNwcml0ZSApIHtcclxuXHJcblx0XHRcdFx0X3YxID0gZWxlbWVudDtcclxuXHRcdFx0XHRfdjEueCAqPSBfY2FudmFzV2lkdGhIYWxmOyBfdjEueSAqPSBfY2FudmFzSGVpZ2h0SGFsZjtcclxuXHJcblx0XHRcdFx0cmVuZGVyU3ByaXRlKCBfdjEsIGVsZW1lbnQsIG1hdGVyaWFsICk7XHJcblxyXG5cdFx0XHR9IGVsc2UgaWYgKCBlbGVtZW50IGluc3RhbmNlb2YgVEhSRUUuUmVuZGVyYWJsZUxpbmUgKSB7XHJcblxyXG5cdFx0XHRcdF92MSA9IGVsZW1lbnQudjE7IF92MiA9IGVsZW1lbnQudjI7XHJcblxyXG5cdFx0XHRcdF92MS5wb3NpdGlvblNjcmVlbi54ICo9IF9jYW52YXNXaWR0aEhhbGY7IF92MS5wb3NpdGlvblNjcmVlbi55ICo9IF9jYW52YXNIZWlnaHRIYWxmO1xyXG5cdFx0XHRcdF92Mi5wb3NpdGlvblNjcmVlbi54ICo9IF9jYW52YXNXaWR0aEhhbGY7IF92Mi5wb3NpdGlvblNjcmVlbi55ICo9IF9jYW52YXNIZWlnaHRIYWxmO1xyXG5cclxuXHRcdFx0XHRfZWxlbUJveC5zZXRGcm9tUG9pbnRzKCBbXHJcblx0XHRcdFx0XHRfdjEucG9zaXRpb25TY3JlZW4sXHJcblx0XHRcdFx0XHRfdjIucG9zaXRpb25TY3JlZW5cclxuXHRcdFx0XHRdICk7XHJcblxyXG5cdFx0XHRcdGlmICggX2NsaXBCb3guaW50ZXJzZWN0c0JveCggX2VsZW1Cb3ggKSA9PT0gdHJ1ZSApIHtcclxuXHJcblx0XHRcdFx0XHRyZW5kZXJMaW5lKCBfdjEsIF92MiwgZWxlbWVudCwgbWF0ZXJpYWwgKTtcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0fSBlbHNlIGlmICggZWxlbWVudCBpbnN0YW5jZW9mIFRIUkVFLlJlbmRlcmFibGVGYWNlICkge1xyXG5cclxuXHRcdFx0XHRfdjEgPSBlbGVtZW50LnYxOyBfdjIgPSBlbGVtZW50LnYyOyBfdjMgPSBlbGVtZW50LnYzO1xyXG5cclxuXHRcdFx0XHRpZiAoIF92MS5wb3NpdGlvblNjcmVlbi56IDwgLSAxIHx8IF92MS5wb3NpdGlvblNjcmVlbi56ID4gMSApIGNvbnRpbnVlO1xyXG5cdFx0XHRcdGlmICggX3YyLnBvc2l0aW9uU2NyZWVuLnogPCAtIDEgfHwgX3YyLnBvc2l0aW9uU2NyZWVuLnogPiAxICkgY29udGludWU7XHJcblx0XHRcdFx0aWYgKCBfdjMucG9zaXRpb25TY3JlZW4ueiA8IC0gMSB8fCBfdjMucG9zaXRpb25TY3JlZW4ueiA+IDEgKSBjb250aW51ZTtcclxuXHJcblx0XHRcdFx0X3YxLnBvc2l0aW9uU2NyZWVuLnggKj0gX2NhbnZhc1dpZHRoSGFsZjsgX3YxLnBvc2l0aW9uU2NyZWVuLnkgKj0gX2NhbnZhc0hlaWdodEhhbGY7XHJcblx0XHRcdFx0X3YyLnBvc2l0aW9uU2NyZWVuLnggKj0gX2NhbnZhc1dpZHRoSGFsZjsgX3YyLnBvc2l0aW9uU2NyZWVuLnkgKj0gX2NhbnZhc0hlaWdodEhhbGY7XHJcblx0XHRcdFx0X3YzLnBvc2l0aW9uU2NyZWVuLnggKj0gX2NhbnZhc1dpZHRoSGFsZjsgX3YzLnBvc2l0aW9uU2NyZWVuLnkgKj0gX2NhbnZhc0hlaWdodEhhbGY7XHJcblxyXG5cdFx0XHRcdGlmICggbWF0ZXJpYWwub3ZlcmRyYXcgPiAwICkge1xyXG5cclxuXHRcdFx0XHRcdGV4cGFuZCggX3YxLnBvc2l0aW9uU2NyZWVuLCBfdjIucG9zaXRpb25TY3JlZW4sIG1hdGVyaWFsLm92ZXJkcmF3ICk7XHJcblx0XHRcdFx0XHRleHBhbmQoIF92Mi5wb3NpdGlvblNjcmVlbiwgX3YzLnBvc2l0aW9uU2NyZWVuLCBtYXRlcmlhbC5vdmVyZHJhdyApO1xyXG5cdFx0XHRcdFx0ZXhwYW5kKCBfdjMucG9zaXRpb25TY3JlZW4sIF92MS5wb3NpdGlvblNjcmVlbiwgbWF0ZXJpYWwub3ZlcmRyYXcgKTtcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRfZWxlbUJveC5zZXRGcm9tUG9pbnRzKCBbXHJcblx0XHRcdFx0XHRfdjEucG9zaXRpb25TY3JlZW4sXHJcblx0XHRcdFx0XHRfdjIucG9zaXRpb25TY3JlZW4sXHJcblx0XHRcdFx0XHRfdjMucG9zaXRpb25TY3JlZW5cclxuXHRcdFx0XHRdICk7XHJcblxyXG5cdFx0XHRcdGlmICggX2NsaXBCb3guaW50ZXJzZWN0c0JveCggX2VsZW1Cb3ggKSA9PT0gdHJ1ZSApIHtcclxuXHJcblx0XHRcdFx0XHRyZW5kZXJGYWNlMyggX3YxLCBfdjIsIF92MywgMCwgMSwgMiwgZWxlbWVudCwgbWF0ZXJpYWwgKTtcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0LyogREVCVUdcclxuXHRcdFx0c2V0TGluZVdpZHRoKCAxICk7XHJcblx0XHRcdHNldFN0cm9rZVN0eWxlKCAncmdiYSggMCwgMjU1LCAwLCAwLjUgKScgKTtcclxuXHRcdFx0X2NvbnRleHQuc3Ryb2tlUmVjdCggX2VsZW1Cb3gubWluLngsIF9lbGVtQm94Lm1pbi55LCBfZWxlbUJveC5tYXgueCAtIF9lbGVtQm94Lm1pbi54LCBfZWxlbUJveC5tYXgueSAtIF9lbGVtQm94Lm1pbi55ICk7XHJcblx0XHRcdCovXHJcblxyXG5cdFx0XHRfY2xlYXJCb3gudW5pb24oIF9lbGVtQm94ICk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdC8qIERFQlVHXHJcblx0XHRzZXRMaW5lV2lkdGgoIDEgKTtcclxuXHRcdHNldFN0cm9rZVN0eWxlKCAncmdiYSggMjU1LCAwLCAwLCAwLjUgKScgKTtcclxuXHRcdF9jb250ZXh0LnN0cm9rZVJlY3QoIF9jbGVhckJveC5taW4ueCwgX2NsZWFyQm94Lm1pbi55LCBfY2xlYXJCb3gubWF4LnggLSBfY2xlYXJCb3gubWluLngsIF9jbGVhckJveC5tYXgueSAtIF9jbGVhckJveC5taW4ueSApO1xyXG5cdFx0Ki9cclxuXHJcblx0XHRfY29udGV4dC5zZXRUcmFuc2Zvcm0oIDEsIDAsIDAsIDEsIDAsIDAgKTtcclxuXHJcblx0fTtcclxuXHJcblx0Ly9cclxuXHJcblx0ZnVuY3Rpb24gY2FsY3VsYXRlTGlnaHRzKCkge1xyXG5cclxuXHRcdF9hbWJpZW50TGlnaHQuc2V0UkdCKCAwLCAwLCAwICk7XHJcblx0XHRfZGlyZWN0aW9uYWxMaWdodHMuc2V0UkdCKCAwLCAwLCAwICk7XHJcblx0XHRfcG9pbnRMaWdodHMuc2V0UkdCKCAwLCAwLCAwICk7XHJcblxyXG5cdFx0Zm9yICggdmFyIGwgPSAwLCBsbCA9IF9saWdodHMubGVuZ3RoOyBsIDwgbGw7IGwgKysgKSB7XHJcblxyXG5cdFx0XHR2YXIgbGlnaHQgPSBfbGlnaHRzWyBsIF07XHJcblx0XHRcdHZhciBsaWdodENvbG9yID0gbGlnaHQuY29sb3I7XHJcblxyXG5cdFx0XHRpZiAoIGxpZ2h0IGluc3RhbmNlb2YgVEhSRUUuQW1iaWVudExpZ2h0ICkge1xyXG5cclxuXHRcdFx0XHRfYW1iaWVudExpZ2h0LmFkZCggbGlnaHRDb2xvciApO1xyXG5cclxuXHRcdFx0fSBlbHNlIGlmICggbGlnaHQgaW5zdGFuY2VvZiBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0ICkge1xyXG5cclxuXHRcdFx0XHQvLyBmb3Igc3ByaXRlc1xyXG5cclxuXHRcdFx0XHRfZGlyZWN0aW9uYWxMaWdodHMuYWRkKCBsaWdodENvbG9yICk7XHJcblxyXG5cdFx0XHR9IGVsc2UgaWYgKCBsaWdodCBpbnN0YW5jZW9mIFRIUkVFLlBvaW50TGlnaHQgKSB7XHJcblxyXG5cdFx0XHRcdC8vIGZvciBzcHJpdGVzXHJcblxyXG5cdFx0XHRcdF9wb2ludExpZ2h0cy5hZGQoIGxpZ2h0Q29sb3IgKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gY2FsY3VsYXRlTGlnaHQoIHBvc2l0aW9uLCBub3JtYWwsIGNvbG9yICkge1xyXG5cclxuXHRcdGZvciAoIHZhciBsID0gMCwgbGwgPSBfbGlnaHRzLmxlbmd0aDsgbCA8IGxsOyBsICsrICkge1xyXG5cclxuXHRcdFx0dmFyIGxpZ2h0ID0gX2xpZ2h0c1sgbCBdO1xyXG5cclxuXHRcdFx0X2xpZ2h0Q29sb3IuY29weSggbGlnaHQuY29sb3IgKTtcclxuXHJcblx0XHRcdGlmICggbGlnaHQgaW5zdGFuY2VvZiBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0ICkge1xyXG5cclxuXHRcdFx0XHR2YXIgbGlnaHRQb3NpdGlvbiA9IF92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKS5ub3JtYWxpemUoKTtcclxuXHJcblx0XHRcdFx0dmFyIGFtb3VudCA9IG5vcm1hbC5kb3QoIGxpZ2h0UG9zaXRpb24gKTtcclxuXHJcblx0XHRcdFx0aWYgKCBhbW91bnQgPD0gMCApIGNvbnRpbnVlO1xyXG5cclxuXHRcdFx0XHRhbW91bnQgKj0gbGlnaHQuaW50ZW5zaXR5O1xyXG5cclxuXHRcdFx0XHRjb2xvci5hZGQoIF9saWdodENvbG9yLm11bHRpcGx5U2NhbGFyKCBhbW91bnQgKSApO1xyXG5cclxuXHRcdFx0fSBlbHNlIGlmICggbGlnaHQgaW5zdGFuY2VvZiBUSFJFRS5Qb2ludExpZ2h0ICkge1xyXG5cclxuXHRcdFx0XHR2YXIgbGlnaHRQb3NpdGlvbiA9IF92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTtcclxuXHJcblx0XHRcdFx0dmFyIGFtb3VudCA9IG5vcm1hbC5kb3QoIF92ZWN0b3IzLnN1YlZlY3RvcnMoIGxpZ2h0UG9zaXRpb24sIHBvc2l0aW9uICkubm9ybWFsaXplKCkgKTtcclxuXHJcblx0XHRcdFx0aWYgKCBhbW91bnQgPD0gMCApIGNvbnRpbnVlO1xyXG5cclxuXHRcdFx0XHRhbW91bnQgKj0gbGlnaHQuZGlzdGFuY2UgPT0gMCA/IDEgOiAxIC0gTWF0aC5taW4oIHBvc2l0aW9uLmRpc3RhbmNlVG8oIGxpZ2h0UG9zaXRpb24gKSAvIGxpZ2h0LmRpc3RhbmNlLCAxICk7XHJcblxyXG5cdFx0XHRcdGlmICggYW1vdW50ID09IDAgKSBjb250aW51ZTtcclxuXHJcblx0XHRcdFx0YW1vdW50ICo9IGxpZ2h0LmludGVuc2l0eTtcclxuXHJcblx0XHRcdFx0Y29sb3IuYWRkKCBfbGlnaHRDb2xvci5tdWx0aXBseVNjYWxhciggYW1vdW50ICkgKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVuZGVyU3ByaXRlKCB2MSwgZWxlbWVudCwgbWF0ZXJpYWwgKSB7XHJcblxyXG5cdFx0c2V0T3BhY2l0eSggbWF0ZXJpYWwub3BhY2l0eSApO1xyXG5cdFx0c2V0QmxlbmRpbmcoIG1hdGVyaWFsLmJsZW5kaW5nICk7XHJcblxyXG5cdFx0dmFyIHNjYWxlWCA9IGVsZW1lbnQuc2NhbGUueCAqIF9jYW52YXNXaWR0aEhhbGY7XHJcblx0XHR2YXIgc2NhbGVZID0gZWxlbWVudC5zY2FsZS55ICogX2NhbnZhc0hlaWdodEhhbGY7XHJcblxyXG5cdFx0dmFyIGRpc3QgPSAwLjUgKiBNYXRoLnNxcnQoIHNjYWxlWCAqIHNjYWxlWCArIHNjYWxlWSAqIHNjYWxlWSApOyAvLyBhbGxvdyBmb3Igcm90YXRlZCBzcHJpdGVcclxuXHRcdF9lbGVtQm94Lm1pbi5zZXQoIHYxLnggLSBkaXN0LCB2MS55IC0gZGlzdCApO1xyXG5cdFx0X2VsZW1Cb3gubWF4LnNldCggdjEueCArIGRpc3QsIHYxLnkgKyBkaXN0ICk7XHJcblxyXG5cdFx0aWYgKCBtYXRlcmlhbCBpbnN0YW5jZW9mIFRIUkVFLlNwcml0ZU1hdGVyaWFsICkge1xyXG5cclxuXHRcdFx0dmFyIHRleHR1cmUgPSBtYXRlcmlhbC5tYXA7XHJcblxyXG5cdFx0XHRpZiAoIHRleHR1cmUgIT09IG51bGwgKSB7XHJcblxyXG5cdFx0XHRcdHZhciBwYXR0ZXJuID0gX3BhdHRlcm5zWyB0ZXh0dXJlLmlkIF07XHJcblxyXG5cdFx0XHRcdGlmICggcGF0dGVybiA9PT0gdW5kZWZpbmVkIHx8IHBhdHRlcm4udmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkge1xyXG5cclxuXHRcdFx0XHRcdHBhdHRlcm4gPSB0ZXh0dXJlVG9QYXR0ZXJuKCB0ZXh0dXJlICk7XHJcblx0XHRcdFx0XHRfcGF0dGVybnNbIHRleHR1cmUuaWQgXSA9IHBhdHRlcm47XHJcblxyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0aWYgKCBwYXR0ZXJuLmNhbnZhcyAhPT0gdW5kZWZpbmVkICkge1xyXG5cclxuXHRcdFx0XHRcdHNldEZpbGxTdHlsZSggcGF0dGVybi5jYW52YXMgKTtcclxuXHJcblx0XHRcdFx0XHR2YXIgYml0bWFwID0gdGV4dHVyZS5pbWFnZTtcclxuXHJcblx0XHRcdFx0XHR2YXIgb3ggPSBiaXRtYXAud2lkdGggKiB0ZXh0dXJlLm9mZnNldC54O1xyXG5cdFx0XHRcdFx0dmFyIG95ID0gYml0bWFwLmhlaWdodCAqIHRleHR1cmUub2Zmc2V0Lnk7XHJcblxyXG5cdFx0XHRcdFx0dmFyIHN4ID0gYml0bWFwLndpZHRoICogdGV4dHVyZS5yZXBlYXQueDtcclxuXHRcdFx0XHRcdHZhciBzeSA9IGJpdG1hcC5oZWlnaHQgKiB0ZXh0dXJlLnJlcGVhdC55O1xyXG5cclxuXHRcdFx0XHRcdHZhciBjeCA9IHNjYWxlWCAvIHN4O1xyXG5cdFx0XHRcdFx0dmFyIGN5ID0gc2NhbGVZIC8gc3k7XHJcblxyXG5cdFx0XHRcdFx0X2NvbnRleHQuc2F2ZSgpO1xyXG5cdFx0XHRcdFx0X2NvbnRleHQudHJhbnNsYXRlKCB2MS54LCB2MS55ICk7XHJcblx0XHRcdFx0XHRpZiAoIG1hdGVyaWFsLnJvdGF0aW9uICE9PSAwICkgX2NvbnRleHQucm90YXRlKCBtYXRlcmlhbC5yb3RhdGlvbiApO1xyXG5cdFx0XHRcdFx0X2NvbnRleHQudHJhbnNsYXRlKCAtIHNjYWxlWCAvIDIsIC0gc2NhbGVZIC8gMiApO1xyXG5cdFx0XHRcdFx0X2NvbnRleHQuc2NhbGUoIGN4LCBjeSApO1xyXG5cdFx0XHRcdFx0X2NvbnRleHQudHJhbnNsYXRlKCAtIG94LCAtIG95ICk7XHJcblx0XHRcdFx0XHRfY29udGV4dC5maWxsUmVjdCggb3gsIG95LCBzeCwgc3kgKTtcclxuXHRcdFx0XHRcdF9jb250ZXh0LnJlc3RvcmUoKTtcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0fSBlbHNlIHtcclxuXHJcblx0XHRcdFx0Ly8gbm8gdGV4dHVyZVxyXG5cclxuXHRcdFx0XHRzZXRGaWxsU3R5bGUoIG1hdGVyaWFsLmNvbG9yLmdldFN0eWxlKCkgKTtcclxuXHJcblx0XHRcdFx0X2NvbnRleHQuc2F2ZSgpO1xyXG5cdFx0XHRcdF9jb250ZXh0LnRyYW5zbGF0ZSggdjEueCwgdjEueSApO1xyXG5cdFx0XHRcdGlmICggbWF0ZXJpYWwucm90YXRpb24gIT09IDAgKSBfY29udGV4dC5yb3RhdGUoIG1hdGVyaWFsLnJvdGF0aW9uICk7XHJcblx0XHRcdFx0X2NvbnRleHQuc2NhbGUoIHNjYWxlWCwgLSBzY2FsZVkgKTtcclxuXHRcdFx0XHRfY29udGV4dC5maWxsUmVjdCggLSAwLjUsIC0gMC41LCAxLCAxICk7XHJcblx0XHRcdFx0X2NvbnRleHQucmVzdG9yZSgpO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdH0gZWxzZSBpZiAoIG1hdGVyaWFsIGluc3RhbmNlb2YgVEhSRUUuU3ByaXRlQ2FudmFzTWF0ZXJpYWwgKSB7XHJcblxyXG5cdFx0XHRzZXRTdHJva2VTdHlsZSggbWF0ZXJpYWwuY29sb3IuZ2V0U3R5bGUoKSApO1xyXG5cdFx0XHRzZXRGaWxsU3R5bGUoIG1hdGVyaWFsLmNvbG9yLmdldFN0eWxlKCkgKTtcclxuXHJcblx0XHRcdF9jb250ZXh0LnNhdmUoKTtcclxuXHRcdFx0X2NvbnRleHQudHJhbnNsYXRlKCB2MS54LCB2MS55ICk7XHJcblx0XHRcdGlmICggbWF0ZXJpYWwucm90YXRpb24gIT09IDAgKSBfY29udGV4dC5yb3RhdGUoIG1hdGVyaWFsLnJvdGF0aW9uICk7XHJcblx0XHRcdF9jb250ZXh0LnNjYWxlKCBzY2FsZVgsIHNjYWxlWSApO1xyXG5cclxuXHRcdFx0bWF0ZXJpYWwucHJvZ3JhbSggX2NvbnRleHQgKTtcclxuXHJcblx0XHRcdF9jb250ZXh0LnJlc3RvcmUoKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0LyogREVCVUdcclxuXHRcdHNldFN0cm9rZVN0eWxlKCAncmdiKDI1NSwyNTUsMCknICk7XHJcblx0XHRfY29udGV4dC5iZWdpblBhdGgoKTtcclxuXHRcdF9jb250ZXh0Lm1vdmVUbyggdjEueCAtIDEwLCB2MS55ICk7XHJcblx0XHRfY29udGV4dC5saW5lVG8oIHYxLnggKyAxMCwgdjEueSApO1xyXG5cdFx0X2NvbnRleHQubW92ZVRvKCB2MS54LCB2MS55IC0gMTAgKTtcclxuXHRcdF9jb250ZXh0LmxpbmVUbyggdjEueCwgdjEueSArIDEwICk7XHJcblx0XHRfY29udGV4dC5zdHJva2UoKTtcclxuXHRcdCovXHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcmVuZGVyTGluZSggdjEsIHYyLCBlbGVtZW50LCBtYXRlcmlhbCApIHtcclxuXHJcblx0XHRzZXRPcGFjaXR5KCBtYXRlcmlhbC5vcGFjaXR5ICk7XHJcblx0XHRzZXRCbGVuZGluZyggbWF0ZXJpYWwuYmxlbmRpbmcgKTtcclxuXHJcblx0XHRfY29udGV4dC5iZWdpblBhdGgoKTtcclxuXHRcdF9jb250ZXh0Lm1vdmVUbyggdjEucG9zaXRpb25TY3JlZW4ueCwgdjEucG9zaXRpb25TY3JlZW4ueSApO1xyXG5cdFx0X2NvbnRleHQubGluZVRvKCB2Mi5wb3NpdGlvblNjcmVlbi54LCB2Mi5wb3NpdGlvblNjcmVlbi55ICk7XHJcblxyXG5cdFx0aWYgKCBtYXRlcmlhbCBpbnN0YW5jZW9mIFRIUkVFLkxpbmVCYXNpY01hdGVyaWFsICkge1xyXG5cclxuXHRcdFx0c2V0TGluZVdpZHRoKCBtYXRlcmlhbC5saW5ld2lkdGggKTtcclxuXHRcdFx0c2V0TGluZUNhcCggbWF0ZXJpYWwubGluZWNhcCApO1xyXG5cdFx0XHRzZXRMaW5lSm9pbiggbWF0ZXJpYWwubGluZWpvaW4gKTtcclxuXHJcblx0XHRcdGlmICggbWF0ZXJpYWwudmVydGV4Q29sb3JzICE9PSBUSFJFRS5WZXJ0ZXhDb2xvcnMgKSB7XHJcblxyXG5cdFx0XHRcdHNldFN0cm9rZVN0eWxlKCBtYXRlcmlhbC5jb2xvci5nZXRTdHlsZSgpICk7XHJcblxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cclxuXHRcdFx0XHR2YXIgY29sb3JTdHlsZTEgPSBlbGVtZW50LnZlcnRleENvbG9yc1sgMCBdLmdldFN0eWxlKCk7XHJcblx0XHRcdFx0dmFyIGNvbG9yU3R5bGUyID0gZWxlbWVudC52ZXJ0ZXhDb2xvcnNbIDEgXS5nZXRTdHlsZSgpO1xyXG5cclxuXHRcdFx0XHRpZiAoIGNvbG9yU3R5bGUxID09PSBjb2xvclN0eWxlMiApIHtcclxuXHJcblx0XHRcdFx0XHRzZXRTdHJva2VTdHlsZSggY29sb3JTdHlsZTEgKTtcclxuXHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHJcblx0XHRcdFx0XHR0cnkge1xyXG5cclxuXHRcdFx0XHRcdFx0dmFyIGdyYWQgPSBfY29udGV4dC5jcmVhdGVMaW5lYXJHcmFkaWVudChcclxuXHRcdFx0XHRcdFx0XHR2MS5wb3NpdGlvblNjcmVlbi54LFxyXG5cdFx0XHRcdFx0XHRcdHYxLnBvc2l0aW9uU2NyZWVuLnksXHJcblx0XHRcdFx0XHRcdFx0djIucG9zaXRpb25TY3JlZW4ueCxcclxuXHRcdFx0XHRcdFx0XHR2Mi5wb3NpdGlvblNjcmVlbi55XHJcblx0XHRcdFx0XHRcdCk7XHJcblx0XHRcdFx0XHRcdGdyYWQuYWRkQ29sb3JTdG9wKCAwLCBjb2xvclN0eWxlMSApO1xyXG5cdFx0XHRcdFx0XHRncmFkLmFkZENvbG9yU3RvcCggMSwgY29sb3JTdHlsZTIgKTtcclxuXHJcblx0XHRcdFx0XHR9IGNhdGNoICggZXhjZXB0aW9uICkge1xyXG5cclxuXHRcdFx0XHRcdFx0Z3JhZCA9IGNvbG9yU3R5bGUxO1xyXG5cclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRzZXRTdHJva2VTdHlsZSggZ3JhZCApO1xyXG5cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRfY29udGV4dC5zdHJva2UoKTtcclxuXHRcdFx0X2VsZW1Cb3guZXhwYW5kQnlTY2FsYXIoIG1hdGVyaWFsLmxpbmV3aWR0aCAqIDIgKTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKCBtYXRlcmlhbCBpbnN0YW5jZW9mIFRIUkVFLkxpbmVEYXNoZWRNYXRlcmlhbCApIHtcclxuXHJcblx0XHRcdHNldExpbmVXaWR0aCggbWF0ZXJpYWwubGluZXdpZHRoICk7XHJcblx0XHRcdHNldExpbmVDYXAoIG1hdGVyaWFsLmxpbmVjYXAgKTtcclxuXHRcdFx0c2V0TGluZUpvaW4oIG1hdGVyaWFsLmxpbmVqb2luICk7XHJcblx0XHRcdHNldFN0cm9rZVN0eWxlKCBtYXRlcmlhbC5jb2xvci5nZXRTdHlsZSgpICk7XHJcblx0XHRcdHNldExpbmVEYXNoKCBbIG1hdGVyaWFsLmRhc2hTaXplLCBtYXRlcmlhbC5nYXBTaXplIF0gKTtcclxuXHJcblx0XHRcdF9jb250ZXh0LnN0cm9rZSgpO1xyXG5cclxuXHRcdFx0X2VsZW1Cb3guZXhwYW5kQnlTY2FsYXIoIG1hdGVyaWFsLmxpbmV3aWR0aCAqIDIgKTtcclxuXHJcblx0XHRcdHNldExpbmVEYXNoKCBbXSApO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiByZW5kZXJGYWNlMyggdjEsIHYyLCB2MywgdXYxLCB1djIsIHV2MywgZWxlbWVudCwgbWF0ZXJpYWwgKSB7XHJcblxyXG5cdFx0X3RoaXMuaW5mby5yZW5kZXIudmVydGljZXMgKz0gMztcclxuXHRcdF90aGlzLmluZm8ucmVuZGVyLmZhY2VzICsrO1xyXG5cclxuXHRcdHNldE9wYWNpdHkoIG1hdGVyaWFsLm9wYWNpdHkgKTtcclxuXHRcdHNldEJsZW5kaW5nKCBtYXRlcmlhbC5ibGVuZGluZyApO1xyXG5cclxuXHRcdF92MXggPSB2MS5wb3NpdGlvblNjcmVlbi54OyBfdjF5ID0gdjEucG9zaXRpb25TY3JlZW4ueTtcclxuXHRcdF92MnggPSB2Mi5wb3NpdGlvblNjcmVlbi54OyBfdjJ5ID0gdjIucG9zaXRpb25TY3JlZW4ueTtcclxuXHRcdF92M3ggPSB2My5wb3NpdGlvblNjcmVlbi54OyBfdjN5ID0gdjMucG9zaXRpb25TY3JlZW4ueTtcclxuXHJcblx0XHRkcmF3VHJpYW5nbGUoIF92MXgsIF92MXksIF92MngsIF92MnksIF92M3gsIF92M3kgKTtcclxuXHJcblx0XHRpZiAoICggbWF0ZXJpYWwgaW5zdGFuY2VvZiBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsIHx8IG1hdGVyaWFsIGluc3RhbmNlb2YgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwgKSAmJiBtYXRlcmlhbC5tYXAgPT09IG51bGwgKSB7XHJcblxyXG5cdFx0XHRfZGlmZnVzZUNvbG9yLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7XHJcblx0XHRcdF9lbWlzc2l2ZUNvbG9yLmNvcHkoIG1hdGVyaWFsLmVtaXNzaXZlICk7XHJcblxyXG5cdFx0XHRpZiAoIG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gVEhSRUUuRmFjZUNvbG9ycyApIHtcclxuXHJcblx0XHRcdFx0X2RpZmZ1c2VDb2xvci5tdWx0aXBseSggZWxlbWVudC5jb2xvciApO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0X2NvbG9yLmNvcHkoIF9hbWJpZW50TGlnaHQgKTtcclxuXHJcblx0XHRcdF9jZW50cm9pZC5jb3B5KCB2MS5wb3NpdGlvbldvcmxkICkuYWRkKCB2Mi5wb3NpdGlvbldvcmxkICkuYWRkKCB2My5wb3NpdGlvbldvcmxkICkuZGl2aWRlU2NhbGFyKCAzICk7XHJcblxyXG5cdFx0XHRjYWxjdWxhdGVMaWdodCggX2NlbnRyb2lkLCBlbGVtZW50Lm5vcm1hbE1vZGVsLCBfY29sb3IgKTtcclxuXHJcblx0XHRcdF9jb2xvci5tdWx0aXBseSggX2RpZmZ1c2VDb2xvciApLmFkZCggX2VtaXNzaXZlQ29sb3IgKTtcclxuXHJcblx0XHRcdG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZVxyXG5cdFx0XHRcdCA/IHN0cm9rZVBhdGgoIF9jb2xvciwgbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoLCBtYXRlcmlhbC53aXJlZnJhbWVMaW5lY2FwLCBtYXRlcmlhbC53aXJlZnJhbWVMaW5lam9pbiApXHJcblx0XHRcdFx0IDogZmlsbFBhdGgoIF9jb2xvciApO1xyXG5cclxuXHRcdH0gZWxzZSBpZiAoIG1hdGVyaWFsIGluc3RhbmNlb2YgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwgfHxcclxuXHRcdFx0XHQgICAgbWF0ZXJpYWwgaW5zdGFuY2VvZiBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsIHx8XHJcblx0XHRcdFx0ICAgIG1hdGVyaWFsIGluc3RhbmNlb2YgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwgKSB7XHJcblxyXG5cdFx0XHRpZiAoIG1hdGVyaWFsLm1hcCAhPT0gbnVsbCApIHtcclxuXHJcblx0XHRcdFx0dmFyIG1hcHBpbmcgPSBtYXRlcmlhbC5tYXAubWFwcGluZztcclxuXHJcblx0XHRcdFx0aWYgKCBtYXBwaW5nID09PSBUSFJFRS5VVk1hcHBpbmcgKSB7XHJcblxyXG5cdFx0XHRcdFx0X3V2cyA9IGVsZW1lbnQudXZzO1xyXG5cdFx0XHRcdFx0cGF0dGVyblBhdGgoIF92MXgsIF92MXksIF92MngsIF92MnksIF92M3gsIF92M3ksIF91dnNbIHV2MSBdLngsIF91dnNbIHV2MSBdLnksIF91dnNbIHV2MiBdLngsIF91dnNbIHV2MiBdLnksIF91dnNbIHV2MyBdLngsIF91dnNbIHV2MyBdLnksIG1hdGVyaWFsLm1hcCApO1xyXG5cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHR9IGVsc2UgaWYgKCBtYXRlcmlhbC5lbnZNYXAgIT09IG51bGwgKSB7XHJcblxyXG5cdFx0XHRcdGlmICggbWF0ZXJpYWwuZW52TWFwLm1hcHBpbmcgPT09IFRIUkVFLlNwaGVyaWNhbFJlZmxlY3Rpb25NYXBwaW5nICkge1xyXG5cclxuXHRcdFx0XHRcdF9ub3JtYWwuY29weSggZWxlbWVudC52ZXJ0ZXhOb3JtYWxzTW9kZWxbIHV2MSBdICkuYXBwbHlNYXRyaXgzKCBfbm9ybWFsVmlld01hdHJpeCApO1xyXG5cdFx0XHRcdFx0X3V2MXggPSAwLjUgKiBfbm9ybWFsLnggKyAwLjU7XHJcblx0XHRcdFx0XHRfdXYxeSA9IDAuNSAqIF9ub3JtYWwueSArIDAuNTtcclxuXHJcblx0XHRcdFx0XHRfbm9ybWFsLmNvcHkoIGVsZW1lbnQudmVydGV4Tm9ybWFsc01vZGVsWyB1djIgXSApLmFwcGx5TWF0cml4MyggX25vcm1hbFZpZXdNYXRyaXggKTtcclxuXHRcdFx0XHRcdF91djJ4ID0gMC41ICogX25vcm1hbC54ICsgMC41O1xyXG5cdFx0XHRcdFx0X3V2MnkgPSAwLjUgKiBfbm9ybWFsLnkgKyAwLjU7XHJcblxyXG5cdFx0XHRcdFx0X25vcm1hbC5jb3B5KCBlbGVtZW50LnZlcnRleE5vcm1hbHNNb2RlbFsgdXYzIF0gKS5hcHBseU1hdHJpeDMoIF9ub3JtYWxWaWV3TWF0cml4ICk7XHJcblx0XHRcdFx0XHRfdXYzeCA9IDAuNSAqIF9ub3JtYWwueCArIDAuNTtcclxuXHRcdFx0XHRcdF91djN5ID0gMC41ICogX25vcm1hbC55ICsgMC41O1xyXG5cclxuXHRcdFx0XHRcdHBhdHRlcm5QYXRoKCBfdjF4LCBfdjF5LCBfdjJ4LCBfdjJ5LCBfdjN4LCBfdjN5LCBfdXYxeCwgX3V2MXksIF91djJ4LCBfdXYyeSwgX3V2M3gsIF91djN5LCBtYXRlcmlhbC5lbnZNYXAgKTtcclxuXHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0fSBlbHNlIHtcclxuXHJcblx0XHRcdFx0X2NvbG9yLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7XHJcblxyXG5cdFx0XHRcdGlmICggbWF0ZXJpYWwudmVydGV4Q29sb3JzID09PSBUSFJFRS5GYWNlQ29sb3JzICkge1xyXG5cclxuXHRcdFx0XHRcdF9jb2xvci5tdWx0aXBseSggZWxlbWVudC5jb2xvciApO1xyXG5cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZVxyXG5cdFx0XHRcdFx0ID8gc3Ryb2tlUGF0aCggX2NvbG9yLCBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGgsIG1hdGVyaWFsLndpcmVmcmFtZUxpbmVjYXAsIG1hdGVyaWFsLndpcmVmcmFtZUxpbmVqb2luIClcclxuXHRcdFx0XHRcdCA6IGZpbGxQYXRoKCBfY29sb3IgKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHR9IGVsc2UgaWYgKCBtYXRlcmlhbCBpbnN0YW5jZW9mIFRIUkVFLk1lc2hOb3JtYWxNYXRlcmlhbCApIHtcclxuXHJcblx0XHRcdF9ub3JtYWwuY29weSggZWxlbWVudC5ub3JtYWxNb2RlbCApLmFwcGx5TWF0cml4MyggX25vcm1hbFZpZXdNYXRyaXggKTtcclxuXHJcblx0XHRcdF9jb2xvci5zZXRSR0IoIF9ub3JtYWwueCwgX25vcm1hbC55LCBfbm9ybWFsLnogKS5tdWx0aXBseVNjYWxhciggMC41ICkuYWRkU2NhbGFyKCAwLjUgKTtcclxuXHJcblx0XHRcdG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZVxyXG5cdFx0XHRcdCA/IHN0cm9rZVBhdGgoIF9jb2xvciwgbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoLCBtYXRlcmlhbC53aXJlZnJhbWVMaW5lY2FwLCBtYXRlcmlhbC53aXJlZnJhbWVMaW5lam9pbiApXHJcblx0XHRcdFx0IDogZmlsbFBhdGgoIF9jb2xvciApO1xyXG5cclxuXHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRfY29sb3Iuc2V0UkdCKCAxLCAxLCAxICk7XHJcblxyXG5cdFx0XHRtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWVcclxuXHRcdFx0XHQgPyBzdHJva2VQYXRoKCBfY29sb3IsIG1hdGVyaWFsLndpcmVmcmFtZUxpbmV3aWR0aCwgbWF0ZXJpYWwud2lyZWZyYW1lTGluZWNhcCwgbWF0ZXJpYWwud2lyZWZyYW1lTGluZWpvaW4gKVxyXG5cdFx0XHRcdCA6IGZpbGxQYXRoKCBfY29sb3IgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0Ly9cclxuXHJcblx0ZnVuY3Rpb24gZHJhd1RyaWFuZ2xlKCB4MCwgeTAsIHgxLCB5MSwgeDIsIHkyICkge1xyXG5cclxuXHRcdF9jb250ZXh0LmJlZ2luUGF0aCgpO1xyXG5cdFx0X2NvbnRleHQubW92ZVRvKCB4MCwgeTAgKTtcclxuXHRcdF9jb250ZXh0LmxpbmVUbyggeDEsIHkxICk7XHJcblx0XHRfY29udGV4dC5saW5lVG8oIHgyLCB5MiApO1xyXG5cdFx0X2NvbnRleHQuY2xvc2VQYXRoKCk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc3Ryb2tlUGF0aCggY29sb3IsIGxpbmV3aWR0aCwgbGluZWNhcCwgbGluZWpvaW4gKSB7XHJcblxyXG5cdFx0c2V0TGluZVdpZHRoKCBsaW5ld2lkdGggKTtcclxuXHRcdHNldExpbmVDYXAoIGxpbmVjYXAgKTtcclxuXHRcdHNldExpbmVKb2luKCBsaW5lam9pbiApO1xyXG5cdFx0c2V0U3Ryb2tlU3R5bGUoIGNvbG9yLmdldFN0eWxlKCkgKTtcclxuXHJcblx0XHRfY29udGV4dC5zdHJva2UoKTtcclxuXHJcblx0XHRfZWxlbUJveC5leHBhbmRCeVNjYWxhciggbGluZXdpZHRoICogMiApO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGZpbGxQYXRoKCBjb2xvciApIHtcclxuXHJcblx0XHRzZXRGaWxsU3R5bGUoIGNvbG9yLmdldFN0eWxlKCkgKTtcclxuXHRcdF9jb250ZXh0LmZpbGwoKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiB0ZXh0dXJlVG9QYXR0ZXJuKCB0ZXh0dXJlICkge1xyXG5cclxuXHRcdGlmICggdGV4dHVyZS52ZXJzaW9uID09PSAwIHx8XHJcblx0XHRcdHRleHR1cmUgaW5zdGFuY2VvZiBUSFJFRS5Db21wcmVzc2VkVGV4dHVyZSB8fFxyXG5cdFx0XHR0ZXh0dXJlIGluc3RhbmNlb2YgVEhSRUUuRGF0YVRleHR1cmUgKSB7XHJcblxyXG5cdFx0XHRyZXR1cm4ge1xyXG5cdFx0XHRcdGNhbnZhczogdW5kZWZpbmVkLFxyXG5cdFx0XHRcdHZlcnNpb246IHRleHR1cmUudmVyc2lvblxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlO1xyXG5cclxuXHRcdGlmICggaW1hZ2UuY29tcGxldGUgPT09IGZhbHNlICkge1xyXG5cclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRjYW52YXM6IHVuZGVmaW5lZCxcclxuXHRcdFx0XHR2ZXJzaW9uOiAwXHJcblx0XHRcdH07XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnY2FudmFzJyApO1xyXG5cdFx0Y2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7XHJcblx0XHRjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xyXG5cclxuXHRcdHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoICcyZCcgKTtcclxuXHRcdGNvbnRleHQuc2V0VHJhbnNmb3JtKCAxLCAwLCAwLCAtIDEsIDAsIGltYWdlLmhlaWdodCApO1xyXG5cdFx0Y29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwICk7XHJcblxyXG5cdFx0dmFyIHJlcGVhdFggPSB0ZXh0dXJlLndyYXBTID09PSBUSFJFRS5SZXBlYXRXcmFwcGluZztcclxuXHRcdHZhciByZXBlYXRZID0gdGV4dHVyZS53cmFwVCA9PT0gVEhSRUUuUmVwZWF0V3JhcHBpbmc7XHJcblxyXG5cdFx0dmFyIHJlcGVhdCA9ICduby1yZXBlYXQnO1xyXG5cclxuXHRcdGlmICggcmVwZWF0WCA9PT0gdHJ1ZSAmJiByZXBlYXRZID09PSB0cnVlICkge1xyXG5cclxuXHRcdFx0cmVwZWF0ID0gJ3JlcGVhdCc7XHJcblxyXG5cdFx0fSBlbHNlIGlmICggcmVwZWF0WCA9PT0gdHJ1ZSApIHtcclxuXHJcblx0XHRcdHJlcGVhdCA9ICdyZXBlYXQteCc7XHJcblxyXG5cdFx0fSBlbHNlIGlmICggcmVwZWF0WSA9PT0gdHJ1ZSApIHtcclxuXHJcblx0XHRcdHJlcGVhdCA9ICdyZXBlYXQteSc7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBwYXR0ZXJuID0gX2NvbnRleHQuY3JlYXRlUGF0dGVybiggY2FudmFzLCByZXBlYXQgKTtcclxuXHJcblx0XHRpZiAoIHRleHR1cmUub25VcGRhdGUgKSB0ZXh0dXJlLm9uVXBkYXRlKCB0ZXh0dXJlICk7XHJcblxyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0Y2FudmFzOiBwYXR0ZXJuLFxyXG5cdFx0XHR2ZXJzaW9uOiB0ZXh0dXJlLnZlcnNpb25cclxuXHRcdH07XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gcGF0dGVyblBhdGgoIHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHUwLCB2MCwgdTEsIHYxLCB1MiwgdjIsIHRleHR1cmUgKSB7XHJcblxyXG5cdFx0dmFyIHBhdHRlcm4gPSBfcGF0dGVybnNbIHRleHR1cmUuaWQgXTtcclxuXHJcblx0XHRpZiAoIHBhdHRlcm4gPT09IHVuZGVmaW5lZCB8fCBwYXR0ZXJuLnZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHtcclxuXHJcblx0XHRcdHBhdHRlcm4gPSB0ZXh0dXJlVG9QYXR0ZXJuKCB0ZXh0dXJlICk7XHJcblx0XHRcdF9wYXR0ZXJuc1sgdGV4dHVyZS5pZCBdID0gcGF0dGVybjtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCBwYXR0ZXJuLmNhbnZhcyAhPT0gdW5kZWZpbmVkICkge1xyXG5cclxuXHRcdFx0c2V0RmlsbFN0eWxlKCBwYXR0ZXJuLmNhbnZhcyApO1xyXG5cclxuXHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRzZXRGaWxsU3R5bGUoICdyZ2JhKCAwLCAwLCAwLCAxKScgKTtcclxuXHRcdFx0X2NvbnRleHQuZmlsbCgpO1xyXG5cdFx0XHRyZXR1cm47XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGh0dHA6Ly9leHRyZW1lbHlzYXRpc2ZhY3Rvcnl0b3RhbGl0YXJpYW5pc20uY29tL2Jsb2cvP3A9MjEyMFxyXG5cclxuXHRcdHZhciBhLCBiLCBjLCBkLCBlLCBmLCBkZXQsIGlkZXQsXHJcblx0XHRvZmZzZXRYID0gdGV4dHVyZS5vZmZzZXQueCAvIHRleHR1cmUucmVwZWF0LngsXHJcblx0XHRvZmZzZXRZID0gdGV4dHVyZS5vZmZzZXQueSAvIHRleHR1cmUucmVwZWF0LnksXHJcblx0XHR3aWR0aCA9IHRleHR1cmUuaW1hZ2Uud2lkdGggKiB0ZXh0dXJlLnJlcGVhdC54LFxyXG5cdFx0aGVpZ2h0ID0gdGV4dHVyZS5pbWFnZS5oZWlnaHQgKiB0ZXh0dXJlLnJlcGVhdC55O1xyXG5cclxuXHRcdHUwID0gKCB1MCArIG9mZnNldFggKSAqIHdpZHRoO1xyXG5cdFx0djAgPSAoIHYwICsgb2Zmc2V0WSApICogaGVpZ2h0O1xyXG5cclxuXHRcdHUxID0gKCB1MSArIG9mZnNldFggKSAqIHdpZHRoO1xyXG5cdFx0djEgPSAoIHYxICsgb2Zmc2V0WSApICogaGVpZ2h0O1xyXG5cclxuXHRcdHUyID0gKCB1MiArIG9mZnNldFggKSAqIHdpZHRoO1xyXG5cdFx0djIgPSAoIHYyICsgb2Zmc2V0WSApICogaGVpZ2h0O1xyXG5cclxuXHRcdHgxIC09IHgwOyB5MSAtPSB5MDtcclxuXHRcdHgyIC09IHgwOyB5MiAtPSB5MDtcclxuXHJcblx0XHR1MSAtPSB1MDsgdjEgLT0gdjA7XHJcblx0XHR1MiAtPSB1MDsgdjIgLT0gdjA7XHJcblxyXG5cdFx0ZGV0ID0gdTEgKiB2MiAtIHUyICogdjE7XHJcblxyXG5cdFx0aWYgKCBkZXQgPT09IDAgKSByZXR1cm47XHJcblxyXG5cdFx0aWRldCA9IDEgLyBkZXQ7XHJcblxyXG5cdFx0YSA9ICggdjIgKiB4MSAtIHYxICogeDIgKSAqIGlkZXQ7XHJcblx0XHRiID0gKCB2MiAqIHkxIC0gdjEgKiB5MiApICogaWRldDtcclxuXHRcdGMgPSAoIHUxICogeDIgLSB1MiAqIHgxICkgKiBpZGV0O1xyXG5cdFx0ZCA9ICggdTEgKiB5MiAtIHUyICogeTEgKSAqIGlkZXQ7XHJcblxyXG5cdFx0ZSA9IHgwIC0gYSAqIHUwIC0gYyAqIHYwO1xyXG5cdFx0ZiA9IHkwIC0gYiAqIHUwIC0gZCAqIHYwO1xyXG5cclxuXHRcdF9jb250ZXh0LnNhdmUoKTtcclxuXHRcdF9jb250ZXh0LnRyYW5zZm9ybSggYSwgYiwgYywgZCwgZSwgZiApO1xyXG5cdFx0X2NvbnRleHQuZmlsbCgpO1xyXG5cdFx0X2NvbnRleHQucmVzdG9yZSgpO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGNsaXBJbWFnZSggeDAsIHkwLCB4MSwgeTEsIHgyLCB5MiwgdTAsIHYwLCB1MSwgdjEsIHUyLCB2MiwgaW1hZ2UgKSB7XHJcblxyXG5cdFx0Ly8gaHR0cDovL2V4dHJlbWVseXNhdGlzZmFjdG9yeXRvdGFsaXRhcmlhbmlzbS5jb20vYmxvZy8/cD0yMTIwXHJcblxyXG5cdFx0dmFyIGEsIGIsIGMsIGQsIGUsIGYsIGRldCwgaWRldCxcclxuXHRcdHdpZHRoID0gaW1hZ2Uud2lkdGggLSAxLFxyXG5cdFx0aGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0IC0gMTtcclxuXHJcblx0XHR1MCAqPSB3aWR0aDsgdjAgKj0gaGVpZ2h0O1xyXG5cdFx0dTEgKj0gd2lkdGg7IHYxICo9IGhlaWdodDtcclxuXHRcdHUyICo9IHdpZHRoOyB2MiAqPSBoZWlnaHQ7XHJcblxyXG5cdFx0eDEgLT0geDA7IHkxIC09IHkwO1xyXG5cdFx0eDIgLT0geDA7IHkyIC09IHkwO1xyXG5cclxuXHRcdHUxIC09IHUwOyB2MSAtPSB2MDtcclxuXHRcdHUyIC09IHUwOyB2MiAtPSB2MDtcclxuXHJcblx0XHRkZXQgPSB1MSAqIHYyIC0gdTIgKiB2MTtcclxuXHJcblx0XHRpZGV0ID0gMSAvIGRldDtcclxuXHJcblx0XHRhID0gKCB2MiAqIHgxIC0gdjEgKiB4MiApICogaWRldDtcclxuXHRcdGIgPSAoIHYyICogeTEgLSB2MSAqIHkyICkgKiBpZGV0O1xyXG5cdFx0YyA9ICggdTEgKiB4MiAtIHUyICogeDEgKSAqIGlkZXQ7XHJcblx0XHRkID0gKCB1MSAqIHkyIC0gdTIgKiB5MSApICogaWRldDtcclxuXHJcblx0XHRlID0geDAgLSBhICogdTAgLSBjICogdjA7XHJcblx0XHRmID0geTAgLSBiICogdTAgLSBkICogdjA7XHJcblxyXG5cdFx0X2NvbnRleHQuc2F2ZSgpO1xyXG5cdFx0X2NvbnRleHQudHJhbnNmb3JtKCBhLCBiLCBjLCBkLCBlLCBmICk7XHJcblx0XHRfY29udGV4dC5jbGlwKCk7XHJcblx0XHRfY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwICk7XHJcblx0XHRfY29udGV4dC5yZXN0b3JlKCk7XHJcblxyXG5cdH1cclxuXHJcblx0Ly8gSGlkZSBhbnRpLWFsaWFzIGdhcHNcclxuXHJcblx0ZnVuY3Rpb24gZXhwYW5kKCB2MSwgdjIsIHBpeGVscyApIHtcclxuXHJcblx0XHR2YXIgeCA9IHYyLnggLSB2MS54LCB5ID0gdjIueSAtIHYxLnksXHJcblx0XHRkZXQgPSB4ICogeCArIHkgKiB5LCBpZGV0O1xyXG5cclxuXHRcdGlmICggZGV0ID09PSAwICkgcmV0dXJuO1xyXG5cclxuXHRcdGlkZXQgPSBwaXhlbHMgLyBNYXRoLnNxcnQoIGRldCApO1xyXG5cclxuXHRcdHggKj0gaWRldDsgeSAqPSBpZGV0O1xyXG5cclxuXHRcdHYyLnggKz0geDsgdjIueSArPSB5O1xyXG5cdFx0djEueCAtPSB4OyB2MS55IC09IHk7XHJcblxyXG5cdH1cclxuXHJcblx0Ly8gQ29udGV4dCBjYWNoZWQgbWV0aG9kcy5cclxuXHJcblx0ZnVuY3Rpb24gc2V0T3BhY2l0eSggdmFsdWUgKSB7XHJcblxyXG5cdFx0aWYgKCBfY29udGV4dEdsb2JhbEFscGhhICE9PSB2YWx1ZSApIHtcclxuXHJcblx0XHRcdF9jb250ZXh0Lmdsb2JhbEFscGhhID0gdmFsdWU7XHJcblx0XHRcdF9jb250ZXh0R2xvYmFsQWxwaGEgPSB2YWx1ZTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc2V0QmxlbmRpbmcoIHZhbHVlICkge1xyXG5cclxuXHRcdGlmICggX2NvbnRleHRHbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gIT09IHZhbHVlICkge1xyXG5cclxuXHRcdFx0aWYgKCB2YWx1ZSA9PT0gVEhSRUUuTm9ybWFsQmxlbmRpbmcgKSB7XHJcblxyXG5cdFx0XHRcdF9jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3Zlcic7XHJcblxyXG5cdFx0XHR9IGVsc2UgaWYgKCB2YWx1ZSA9PT0gVEhSRUUuQWRkaXRpdmVCbGVuZGluZyApIHtcclxuXHJcblx0XHRcdFx0X2NvbnRleHQuZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2xpZ2h0ZXInO1xyXG5cclxuXHRcdFx0fSBlbHNlIGlmICggdmFsdWUgPT09IFRIUkVFLlN1YnRyYWN0aXZlQmxlbmRpbmcgKSB7XHJcblxyXG5cdFx0XHRcdF9jb250ZXh0Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdkYXJrZXInO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0X2NvbnRleHRHbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSB2YWx1ZTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc2V0TGluZVdpZHRoKCB2YWx1ZSApIHtcclxuXHJcblx0XHRpZiAoIF9jb250ZXh0TGluZVdpZHRoICE9PSB2YWx1ZSApIHtcclxuXHJcblx0XHRcdF9jb250ZXh0LmxpbmVXaWR0aCA9IHZhbHVlO1xyXG5cdFx0XHRfY29udGV4dExpbmVXaWR0aCA9IHZhbHVlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzZXRMaW5lQ2FwKCB2YWx1ZSApIHtcclxuXHJcblx0XHQvLyBcImJ1dHRcIiwgXCJyb3VuZFwiLCBcInNxdWFyZVwiXHJcblxyXG5cdFx0aWYgKCBfY29udGV4dExpbmVDYXAgIT09IHZhbHVlICkge1xyXG5cclxuXHRcdFx0X2NvbnRleHQubGluZUNhcCA9IHZhbHVlO1xyXG5cdFx0XHRfY29udGV4dExpbmVDYXAgPSB2YWx1ZTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc2V0TGluZUpvaW4oIHZhbHVlICkge1xyXG5cclxuXHRcdC8vIFwicm91bmRcIiwgXCJiZXZlbFwiLCBcIm1pdGVyXCJcclxuXHJcblx0XHRpZiAoIF9jb250ZXh0TGluZUpvaW4gIT09IHZhbHVlICkge1xyXG5cclxuXHRcdFx0X2NvbnRleHQubGluZUpvaW4gPSB2YWx1ZTtcclxuXHRcdFx0X2NvbnRleHRMaW5lSm9pbiA9IHZhbHVlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzZXRTdHJva2VTdHlsZSggdmFsdWUgKSB7XHJcblxyXG5cdFx0aWYgKCBfY29udGV4dFN0cm9rZVN0eWxlICE9PSB2YWx1ZSApIHtcclxuXHJcblx0XHRcdF9jb250ZXh0LnN0cm9rZVN0eWxlID0gdmFsdWU7XHJcblx0XHRcdF9jb250ZXh0U3Ryb2tlU3R5bGUgPSB2YWx1ZTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gc2V0RmlsbFN0eWxlKCB2YWx1ZSApIHtcclxuXHJcblx0XHRpZiAoIF9jb250ZXh0RmlsbFN0eWxlICE9PSB2YWx1ZSApIHtcclxuXHJcblx0XHRcdF9jb250ZXh0LmZpbGxTdHlsZSA9IHZhbHVlO1xyXG5cdFx0XHRfY29udGV4dEZpbGxTdHlsZSA9IHZhbHVlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBzZXRMaW5lRGFzaCggdmFsdWUgKSB7XHJcblxyXG5cdFx0aWYgKCBfY29udGV4dExpbmVEYXNoLmxlbmd0aCAhPT0gdmFsdWUubGVuZ3RoICkge1xyXG5cclxuXHRcdFx0X2NvbnRleHQuc2V0TGluZURhc2goIHZhbHVlICk7XHJcblx0XHRcdF9jb250ZXh0TGluZURhc2ggPSB2YWx1ZTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcbn07XHJcbiJdfQ==